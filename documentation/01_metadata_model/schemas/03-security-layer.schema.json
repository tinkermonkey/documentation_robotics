{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/03-security-layer.json",
  "title": "Security Layer Schema",
  "description": "Custom security model specification for RBAC, ABAC, field-level security, and policy-based access control",
  "type": "object",
  "required": ["version", "application", "authentication", "roles", "resources", "dataClassification"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Specification version"
    },
    "application": {
      "type": "string",
      "description": "Application identifier"
    },
    "archimateRef": {
      "type": "string",
      "format": "uuid",
      "description": "Reference to ApplicationComponent"
    },
    "authentication": {
      "$ref": "#/definitions/AuthenticationConfig"
    },
    "actors": {
      "type": "array",
      "items": { "$ref": "#/definitions/Actor" },
      "description": "Actors in the system (STS-ml inspired)"
    },
    "roles": {
      "type": "array",
      "items": { "$ref": "#/definitions/Role" },
      "minItems": 1
    },
    "permissions": {
      "type": "array",
      "items": { "$ref": "#/definitions/Permission" }
    },
    "resources": {
      "type": "array",
      "items": { "$ref": "#/definitions/SecureResource" },
      "minItems": 1
    },
    "informationEntities": {
      "type": "array",
      "items": { "$ref": "#/definitions/InformationEntity" },
      "description": "Information entities with fine-grained rights (STS-ml inspired)"
    },
    "delegations": {
      "type": "array",
      "items": { "$ref": "#/definitions/Delegation" },
      "description": "Explicit delegations (STS-ml inspired)"
    },
    "securityConstraints": {
      "$ref": "#/definitions/SecurityConstraints",
      "description": "Security patterns and constraints (STS-ml inspired)"
    },
    "policies": {
      "type": "array",
      "items": { "$ref": "#/definitions/SecurityPolicy" }
    },
    "dataClassification": {
      "$ref": "#/definitions/DataClassification"
    },
    "socialDependencies": {
      "type": "array",
      "items": { "$ref": "#/definitions/SocialDependency" },
      "description": "Dependencies and trust between actors (STS-ml inspired)"
    },
    "accountability": {
      "type": "array",
      "items": { "$ref": "#/definitions/AccountabilityRequirement" },
      "description": "Accountability requirements (STS-ml inspired)"
    },
    "threats": {
      "type": "array",
      "items": { "$ref": "#/definitions/Threat" },
      "description": "Security threats and countermeasures (STS-ml inspired)"
    }
  },
  "definitions": {
    "AuthenticationConfig": {
      "type": "object",
      "required": ["provider", "sessionTimeout"],
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["oauth2", "openid-connect", "saml", "jwt", "session", "api-key", "certificate"]
        },
        "sessionTimeout": {
          "type": "integer",
          "minimum": 1,
          "description": "Session timeout in minutes"
        },
        "mfaRequired": {
          "type": "boolean",
          "default": false
        },
        "passwordPolicy": {
          "$ref": "#/definitions/PasswordPolicy"
        },
        "oauth2": {
          "type": "object",
          "properties": {
            "authorizationUrl": { "type": "string", "format": "uri" },
            "tokenUrl": { "type": "string", "format": "uri" },
            "userInfoUrl": { "type": "string", "format": "uri" },
            "clientId": { "type": "string" },
            "scopes": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "jwt": {
          "type": "object",
          "properties": {
            "issuer": { "type": "string", "format": "uri" },
            "audience": { "type": "string" },
            "algorithm": { "type": "string" },
            "publicKeyUrl": { "type": "string", "format": "uri" }
          }
        }
      }
    },
    "PasswordPolicy": {
      "type": "object",
      "properties": {
        "minLength": {
          "type": "integer",
          "minimum": 1,
          "default": 8
        },
        "maxLength": {
          "type": "integer",
          "minimum": 1
        },
        "requireUppercase": {
          "type": "boolean",
          "default": true
        },
        "requireLowercase": {
          "type": "boolean",
          "default": true
        },
        "requireNumbers": {
          "type": "boolean",
          "default": true
        },
        "requireSpecialChars": {
          "type": "boolean",
          "default": true
        },
        "preventReuse": {
          "type": "integer",
          "minimum": 0,
          "default": 5
        },
        "expiryDays": {
          "type": "integer",
          "minimum": 1
        },
        "lockoutAttempts": {
          "type": "integer",
          "minimum": 1,
          "default": 5
        },
        "lockoutDuration": {
          "type": "integer",
          "minimum": 1,
          "default": 30,
          "description": "Lockout duration in minutes"
        }
      }
    },
    "Role": {
      "type": "object",
      "required": ["name", "displayName"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Unique role identifier"
        },
        "displayName": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string"
        },
        "level": {
          "type": "integer",
          "minimum": 0,
          "description": "Hierarchy level"
        },
        "inheritsFrom": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Parent role names"
        },
        "permissions": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Permission names"
        },
        "isSystemRole": {
          "type": "boolean",
          "default": false
        },
        "assignable": {
          "type": "boolean",
          "default": true
        }
      }
    },
    "Permission": {
      "type": "object",
      "required": ["name", "scope", "resource", "action"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z0-9-_]+\\.(\\*|[a-z0-9-_]+)(\\.[a-z0-9-_]+)?$",
          "description": "Permission name in format: resource.action or resource.*"
        },
        "description": {
          "type": "string"
        },
        "scope": {
          "type": "string",
          "enum": ["global", "resource", "attribute", "owner"]
        },
        "resource": {
          "type": "string"
        },
        "action": {
          "type": "string"
        }
      }
    },
    "SecureResource": {
      "type": "object",
      "required": ["resource", "type", "operations"],
      "properties": {
        "resource": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "type": "string",
          "enum": ["api", "screen", "data", "file", "service"]
        },
        "description": {
          "type": "string"
        },
        "archimateRef": {
          "type": "string",
          "format": "uuid"
        },
        "apiOperations": {
          "type": "array",
          "items": { "type": "string" }
        },
        "operations": {
          "type": "array",
          "items": { "$ref": "#/definitions/ResourceOperation" },
          "minItems": 1
        },
        "fieldAccess": {
          "type": "array",
          "items": { "$ref": "#/definitions/FieldAccessControl" }
        }
      }
    },
    "ResourceOperation": {
      "type": "object",
      "required": ["operation"],
      "properties": {
        "operation": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string"
        },
        "allowRoles": {
          "type": "array",
          "items": { "type": "string" }
        },
        "denyRoles": {
          "type": "array",
          "items": { "type": "string" }
        },
        "allowPermissions": {
          "type": "array",
          "items": { "type": "string" }
        },
        "requireAll": {
          "type": "boolean",
          "default": false
        },
        "conditions": {
          "type": "array",
          "items": { "$ref": "#/definitions/AccessCondition" }
        },
        "rateLimit": {
          "type": "object",
          "properties": {
            "requests": { "type": "integer", "minimum": 1 },
            "window": { "type": "string" }
          }
        },
        "audit": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "level": {
              "type": "string",
              "enum": ["info", "warning", "critical"]
            }
          }
        }
      }
    },
    "AccessCondition": {
      "type": "object",
      "required": ["field", "operator", "value"],
      "properties": {
        "field": {
          "type": "string"
        },
        "operator": {
          "type": "string",
          "enum": ["equals", "notEquals", "in", "notIn", "greaterThan", "lessThan", "greaterThanOrEqual", "lessThanOrEqual", "contains", "notContains", "startsWith", "endsWith", "matches", "exists", "notExists"]
        },
        "value": {
          "description": "Comparison value (can be any type)"
        },
        "message": {
          "type": "string"
        },
        "source": {
          "type": "string",
          "enum": ["constant", "user-attribute", "resource-field", "context", "computed"]
        }
      }
    },
    "FieldAccessControl": {
      "type": "object",
      "required": ["field"],
      "properties": {
        "field": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "read": {
          "type": "object",
          "properties": {
            "allowRoles": {
              "type": "array",
              "items": { "type": "string" }
            },
            "denyRoles": {
              "type": "array",
              "items": { "type": "string" }
            },
            "conditions": {
              "type": "array",
              "items": { "$ref": "#/definitions/AccessCondition" }
            },
            "mask": {
              "type": "string",
              "enum": ["none", "partial", "full", "hash", "redact"]
            }
          }
        },
        "write": {
          "type": "object",
          "properties": {
            "allowRoles": {
              "type": "array",
              "items": { "type": "string" }
            },
            "denyRoles": {
              "type": "array",
              "items": { "type": "string" }
            },
            "conditions": {
              "type": "array",
              "items": { "$ref": "#/definitions/AccessCondition" }
            },
            "validation": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": { "type": "string" }
                }
              }
            }
          }
        }
      }
    },
    "SecurityPolicy": {
      "type": "object",
      "required": ["name", "enabled", "priority", "target", "rules"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string"
        },
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "priority": {
          "type": "integer",
          "description": "Higher priority executes first"
        },
        "target": {
          "type": "string",
          "enum": ["all", "api", "data", "screen"]
        },
        "rules": {
          "type": "array",
          "items": { "$ref": "#/definitions/PolicyRule" },
          "minItems": 1
        }
      }
    },
    "PolicyRule": {
      "type": "object",
      "required": ["condition", "effect"],
      "properties": {
        "condition": {
          "type": "object",
          "required": ["expression"],
          "properties": {
            "expression": { "type": "string" }
          }
        },
        "effect": {
          "type": "string",
          "enum": ["allow", "deny", "audit", "warn"]
        },
        "message": {
          "type": "string"
        },
        "actions": {
          "type": "array",
          "items": { "$ref": "#/definitions/PolicyAction" }
        }
      }
    },
    "PolicyAction": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["allow", "deny", "audit-access", "require-mfa", "require-approval", "apply-mask", "apply-encryption", "apply-retention", "notify", "rate-limit", "check-ip-whitelist", "check-time-window"]
        },
        "parameters": {
          "type": "object"
        }
      }
    },
    "DataClassification": {
      "type": "object",
      "required": ["classifications"],
      "properties": {
        "classifications": {
          "type": "array",
          "items": { "$ref": "#/definitions/Classification" },
          "minItems": 1
        }
      }
    },
    "Classification": {
      "type": "object",
      "required": ["level", "label", "description", "encryption", "retention", "accessControl", "auditLevel"],
      "properties": {
        "level": {
          "type": "string",
          "enum": ["public", "internal", "confidential", "restricted"]
        },
        "label": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "encryption": {
          "type": "string",
          "enum": ["none", "in-transit", "at-rest", "both", "end-to-end"]
        },
        "retention": {
          "type": "object",
          "properties": {
            "period": { "type": "string" },
            "deleteAfter": { "type": "boolean" },
            "reviewRequired": { "type": "boolean" }
          }
        },
        "accessControl": {
          "type": "string",
          "enum": ["open", "authenticated", "role-based", "attribute-based"]
        },
        "auditLevel": {
          "type": "string",
          "enum": ["none", "minimal", "standard", "comprehensive"]
        },
        "masking": {
          "type": "string",
          "enum": ["none", "partial", "full", "hash"]
        }
      }
    },
    "Actor": {
      "type": "object",
      "required": ["id", "name", "type"],
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "type": "string",
          "enum": ["role", "agent", "organization", "system"]
        },
        "description": {
          "type": "string"
        },
        "trustLevel": {
          "type": "string",
          "enum": ["none", "low", "medium", "high", "full"]
        },
        "businessActorRef": {
          "type": "string",
          "description": "Reference to Business Layer BusinessActor ID"
        },
        "stakeholderRef": {
          "type": "string",
          "description": "Reference to Motivation Layer Stakeholder ID"
        },
        "objectives": {
          "type": "array",
          "items": { "$ref": "#/definitions/ActorObjective" }
        },
        "dependencies": {
          "type": "array",
          "items": { "$ref": "#/definitions/ActorDependency" }
        }
      }
    },
    "ActorObjective": {
      "type": "object",
      "required": ["id", "description"],
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "minLength": 1
        },
        "criticality": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "motivationGoalRef": {
          "type": "string",
          "description": "Reference to Motivation Layer Goal ID"
        }
      }
    },
    "ActorDependency": {
      "type": "object",
      "required": ["dependee", "resource", "criticality"],
      "properties": {
        "dependee": {
          "type": "string",
          "minLength": 1
        },
        "resource": {
          "type": "string",
          "minLength": 1
        },
        "objective": {
          "type": "string"
        },
        "criticality": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        }
      }
    },
    "InformationEntity": {
      "type": "object",
      "required": ["id", "name", "classification", "authorizationRequirements"],
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string"
        },
        "classification": {
          "type": "string",
          "enum": ["public", "internal", "confidential", "restricted"]
        },
        "dataObjectRef": {
          "type": "string"
        },
        "authorizationRequirements": {
          "type": "array",
          "items": { "$ref": "#/definitions/InformationRight" },
          "minItems": 1
        }
      }
    },
    "InformationRight": {
      "type": "object",
      "required": ["actor"],
      "properties": {
        "actor": {
          "type": "string",
          "minLength": 1
        },
        "constraint": {
          "type": "string"
        },
        "produce": {
          "type": "boolean"
        },
        "read": {
          "type": "boolean"
        },
        "modify": {
          "oneOf": [
            { "type": "boolean" },
            {
              "type": "object",
              "properties": {
                "constraint": { "type": "string" }
              }
            }
          ]
        },
        "distribute": {
          "oneOf": [
            { "type": "boolean" },
            {
              "type": "object",
              "properties": {
                "constraint": { "type": "string" }
              }
            }
          ]
        },
        "delete": {
          "type": "boolean"
        }
      }
    },
    "Delegation": {
      "type": "object",
      "required": ["delegator", "delegatee", "delegationType"],
      "properties": {
        "id": {
          "type": "string"
        },
        "delegator": {
          "type": "string",
          "minLength": 1
        },
        "delegatee": {
          "type": "string",
          "minLength": 1
        },
        "delegationType": {
          "type": "string",
          "enum": ["execution", "permission", "approval"]
        },
        "description": {
          "type": "string"
        },
        "permission": {
          "type": "string"
        },
        "objective": {
          "type": "string"
        },
        "resource": {
          "type": "string"
        },
        "constraints": {
          "type": "object",
          "properties": {
            "retainOversight": { "type": "boolean" },
            "retainControl": { "type": "boolean" },
            "timebound": { "type": "string" },
            "revocable": { "type": "boolean", "default": true },
            "maxDelegationDepth": { "type": "integer", "minimum": 1 },
            "excludes": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        }
      }
    },
    "SecurityConstraints": {
      "type": "object",
      "properties": {
        "separationOfDuty": {
          "type": "array",
          "items": { "$ref": "#/definitions/SeparationOfDuty" }
        },
        "bindingOfDuty": {
          "type": "array",
          "items": { "$ref": "#/definitions/BindingOfDuty" }
        },
        "needToKnow": {
          "type": "array",
          "items": { "$ref": "#/definitions/NeedToKnow" }
        }
      }
    },
    "SeparationOfDuty": {
      "type": "object",
      "required": ["name", "tasks", "message"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string"
        },
        "tasks": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 2
        },
        "roles": {
          "type": "array",
          "items": { "type": "string" }
        },
        "message": {
          "type": "string",
          "minLength": 1
        },
        "mutuallyExclusive": {
          "type": "boolean",
          "default": true
        }
      }
    },
    "BindingOfDuty": {
      "type": "object",
      "required": ["name", "tasks", "message"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string"
        },
        "tasks": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 2
        },
        "scope": {
          "type": "string"
        },
        "message": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "NeedToKnow": {
      "type": "object",
      "required": ["name", "resource", "objective", "message"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1
        },
        "resource": {
          "type": "string",
          "minLength": 1
        },
        "objective": {
          "type": "string",
          "minLength": 1
        },
        "message": {
          "type": "string",
          "minLength": 1
        },
        "justificationRequired": {
          "type": "boolean",
          "default": false
        }
      }
    },
    "SocialDependency": {
      "type": "object",
      "required": ["depender", "dependee", "resource", "criticality"],
      "properties": {
        "id": {
          "type": "string"
        },
        "depender": {
          "type": "string",
          "minLength": 1
        },
        "dependee": {
          "type": "string",
          "minLength": 1
        },
        "resource": {
          "type": "string",
          "minLength": 1
        },
        "objective": {
          "type": "string"
        },
        "criticality": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "trust": {
          "type": "object",
          "properties": {
            "trustLevel": {
              "type": "string",
              "enum": ["none", "low", "medium", "high", "full"]
            },
            "verification": {
              "type": "string",
              "enum": ["none", "manual", "automated", "continuous"]
            }
          }
        },
        "commitmentRefs": {
          "type": "array",
          "items": { "type": "string" },
          "description": "References to Motivation Layer Constraint IDs for commitments"
        }
      }
    },
    "AccountabilityRequirement": {
      "type": "object",
      "required": ["action", "nonRepudiation", "auditRetention"],
      "properties": {
        "id": {
          "type": "string"
        },
        "action": {
          "type": "string",
          "minLength": 1
        },
        "resource": {
          "type": "string"
        },
        "nonRepudiation": {
          "type": "boolean"
        },
        "purposeDeclaration": {
          "type": "string",
          "enum": ["none", "optional", "required", "mandatory"]
        },
        "challengeable": {
          "type": "boolean",
          "default": false
        },
        "requiresEvidence": {
          "type": "array",
          "items": { "$ref": "#/definitions/Evidence" }
        },
        "auditRetention": {
          "type": "string",
          "minLength": 1
        },
        "purposeTypes": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "Evidence": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["digital-signature", "timestamp", "ip-address", "device-fingerprint", "biometric", "user-authentication", "access-reason", "approval-chain", "video-recording"]
        },
        "strength": {
          "type": "string",
          "enum": ["weak", "moderate", "strong", "cryptographic"]
        },
        "source": {
          "type": "string"
        }
      }
    },
    "Threat": {
      "type": "object",
      "required": ["id", "name", "description", "threatens", "likelihood", "impact"],
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "minLength": 1
        },
        "threatens": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        },
        "threatActors": {
          "type": "array",
          "items": { "type": "string" }
        },
        "likelihood": {
          "type": "string",
          "enum": ["very-low", "low", "medium", "high", "very-high"]
        },
        "impact": {
          "type": "string",
          "enum": ["negligible", "low", "medium", "high", "critical"]
        },
        "assessmentRef": {
          "type": "string",
          "description": "Reference to Motivation Layer Assessment ID"
        },
        "mitigatedByRequirements": {
          "type": "array",
          "items": { "type": "string" },
          "description": "References to Motivation Layer Requirement IDs"
        },
        "countermeasures": {
          "type": "array",
          "items": { "$ref": "#/definitions/Countermeasure" }
        }
      }
    },
    "Countermeasure": {
      "type": "object",
      "required": ["type", "description"],
      "properties": {
        "type": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "minLength": 1
        },
        "effectiveness": {
          "type": "string",
          "enum": ["low", "medium", "high", "very-high"]
        },
        "implemented": {
          "type": "boolean",
          "default": false
        },
        "implementedBy": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  }
}
