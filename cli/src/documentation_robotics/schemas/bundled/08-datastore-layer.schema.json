{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/08-datastore-layer.schema.json",
  "title": "Datastore Layer Layer Schema",
  "description": "Defines physical data storage schemas using SQL DDL, including tables, columns, indexes, constraints, and database-specific objects.",
  "type": "object",
  "properties": {
    "databases": {
      "type": "array",
      "description": "Collection of Database entities",
      "items": {
        "$ref": "#/definitions/Database"
      }
    },
    "database-schemas": {
      "type": "array",
      "description": "Collection of DatabaseSchema entities",
      "items": {
        "$ref": "#/definitions/DatabaseSchema"
      }
    },
    "tables": {
      "type": "array",
      "description": "Collection of Table entities",
      "items": {
        "$ref": "#/definitions/Table"
      }
    },
    "columns": {
      "type": "array",
      "description": "Collection of Column entities",
      "items": {
        "$ref": "#/definitions/Column"
      }
    },
    "constraints": {
      "type": "array",
      "description": "Collection of Constraint entities",
      "items": {
        "$ref": "#/definitions/Constraint"
      }
    },
    "indexes": {
      "type": "array",
      "description": "Collection of Index entities",
      "items": {
        "$ref": "#/definitions/Index"
      }
    },
    "views": {
      "type": "array",
      "description": "Collection of View entities",
      "items": {
        "$ref": "#/definitions/View"
      }
    },
    "triggers": {
      "type": "array",
      "description": "Collection of Trigger entities",
      "items": {
        "$ref": "#/definitions/Trigger"
      }
    },
    "sequences": {
      "type": "array",
      "description": "Collection of Sequence entities",
      "items": {
        "$ref": "#/definitions/Sequence"
      }
    },
    "functions": {
      "type": "array",
      "description": "Collection of Function entities",
      "items": {
        "$ref": "#/definitions/Function"
      }
    }
  },
  "definitions": {
    "DatabaseType": {
      "type": "string",
      "enum": [
        "PostgreSQL",
        "MySQL",
        "SQLite",
        "MariaDB",
        "Oracle",
        "SQL Server"
      ]
    },
    "SQLDataType": {
      "type": "string",
      "enum": [
        "SMALLINT",
        "INTEGER",
        "BIGINT",
        "SERIAL",
        "BIGSERIAL",
        "DECIMAL(precision, scale)",
        "NUMERIC(precision, scale)",
        "REAL",
        "DOUBLE PRECISION",
        "CHAR(length)",
        "VARCHAR(length)",
        "TEXT",
        "BYTEA",
        "BLOB",
        "BOOLEAN",
        "DATE",
        "TIME",
        "TIMESTAMP",
        "TIMESTAMPTZ",
        "INTERVAL",
        "JSON",
        "JSONB",
        "UUID",
        "INTEGER[]",
        "TEXT[]",
        "etc.",
        "ENUM('value1', 'value2', ...)"
      ]
    },
    "GenerationType": {
      "type": "string",
      "enum": [
        "ALWAYS",
        "BY_DEFAULT"
      ]
    },
    "ConstraintType": {
      "type": "string",
      "enum": [
        "PRIMARY_KEY",
        "UNIQUE",
        "FOREIGN_KEY",
        "CHECK",
        "EXCLUSION"
      ]
    },
    "ReferentialAction": {
      "type": "string",
      "enum": [
        "CASCADE",
        "SET_NULL",
        "SET_DEFAULT",
        "RESTRICT",
        "NO_ACTION"
      ]
    },
    "IndexMethod": {
      "type": "string",
      "enum": [
        "BTREE",
        "HASH",
        "GIN",
        "GIST",
        "BRIN",
        "SP-GIST"
      ]
    },
    "RefreshMode": {
      "type": "string",
      "enum": [
        "ON_COMMIT",
        "ON_DEMAND",
        "SCHEDULED"
      ]
    },
    "TriggerTiming": {
      "type": "string",
      "enum": [
        "BEFORE",
        "AFTER",
        "INSTEAD_OF"
      ]
    },
    "TriggerEvent": {
      "type": "string",
      "enum": [
        "INSERT",
        "UPDATE",
        "DELETE",
        "TRUNCATE"
      ]
    },
    "TriggerForEach": {
      "type": "string",
      "enum": [
        "ROW",
        "STATEMENT"
      ]
    },
    "SequenceDataType": {
      "type": "string",
      "enum": [
        "SMALLINT",
        "INTEGER",
        "BIGINT"
      ]
    },
    "FunctionLanguage": {
      "type": "string",
      "enum": [
        "SQL",
        "PLPGSQL",
        "PLPYTHON3U",
        "PLPERL",
        "PLPYTHON",
        "C"
      ]
    },
    "FunctionVolatility": {
      "type": "string",
      "enum": [
        "IMMUTABLE",
        "STABLE",
        "VOLATILE"
      ]
    },
    "ParallelSafety": {
      "type": "string",
      "enum": [
        "UNSAFE",
        "RESTRICTED",
        "SAFE"
      ]
    },
    "SecurityDefiner": {
      "type": "string",
      "enum": [
        "INVOKER",
        "DEFINER"
      ]
    },
    "ParameterMode": {
      "type": "string",
      "enum": [
        "IN",
        "OUT",
        "INOUT",
        "VARIADIC"
      ]
    },
    "Database": {
      "type": "object",
      "description": "Database instance containing schemas",
      "required": [
        "id",
        "name",
        "type",
        "version"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "$ref": "#/definitions/DatabaseType"
        },
        "version": {
          "type": "string",
          "minLength": 1
        },
        "charset": {
          "type": "string",
          "minLength": 1
        },
        "collation": {
          "type": "string",
          "minLength": 1
        },
        "schemas": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "DatabaseSchema": {
      "type": "object",
      "description": "Logical grouping of database objects",
      "required": [
        "id",
        "name"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "owner": {
          "type": "string",
          "minLength": 1
        },
        "tables": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        },
        "views": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        },
        "functions": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        },
        "sequences": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "Table": {
      "type": "object",
      "description": "Database table definition",
      "required": [
        "id",
        "name"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "schema": {
          "type": "string",
          "minLength": 1
        },
        "tablespace": {
          "type": "string",
          "minLength": 1
        },
        "columns": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        },
        "constraints": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        },
        "indexes": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        },
        "triggers": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "Column": {
      "type": "object",
      "description": "Table column definition",
      "required": [
        "id",
        "name",
        "dataType"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "dataType": {
          "type": "string",
          "minLength": 1
        },
        "nullable": {
          "type": "boolean"
        },
        "defaultValue": {
          "type": "string",
          "minLength": 1
        },
        "generated": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "Constraint": {
      "type": "object",
      "description": "Table constraint",
      "required": [
        "id",
        "name",
        "type"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "$ref": "#/definitions/ConstraintType"
        }
      }
    },
    "Index": {
      "type": "object",
      "description": "Database index for query optimization",
      "required": [
        "id",
        "name"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "columns": {
          "type": "string",
          "minLength": 1
        },
        "unique": {
          "type": "boolean"
        },
        "method": {
          "type": "string",
          "minLength": 1
        },
        "where": {
          "type": "string",
          "minLength": 1
        },
        "include": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "View": {
      "type": "object",
      "description": "Database view",
      "required": [
        "id",
        "name"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "definition": {
          "type": "string",
          "minLength": 1
        },
        "materialized": {
          "type": "boolean"
        }
      }
    },
    "Trigger": {
      "type": "object",
      "description": "A database trigger that automatically executes in response to data modification events (INSERT, UPDATE, DELETE). Enables reactive database behavior and data integrity enforcement.",
      "required": [
        "id",
        "name",
        "table",
        "timing",
        "events",
        "forEach",
        "functionName",
        "condition"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "table": {
          "type": "string",
          "minLength": 1
        },
        "timing": {
          "$ref": "#/definitions/TriggerTiming"
        },
        "events": {
          "type": "string",
          "minLength": 1
        },
        "forEach": {
          "$ref": "#/definitions/TriggerForEach"
        },
        "functionName": {
          "type": "string",
          "minLength": 1
        },
        "condition": {
          "type": "string",
          "minLength": 1
        },
        "enabled": {
          "type": "boolean"
        }
      }
    },
    "Sequence": {
      "type": "object",
      "description": "A database sequence generator that produces unique, ordered numeric values. Used for generating primary keys, order numbers, or other sequential identifiers.",
      "required": [
        "id",
        "name"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "schema": {
          "type": "string",
          "minLength": 1
        },
        "dataType": {
          "$ref": "#/definitions/SequenceDataType"
        },
        "startValue": {
          "type": "integer"
        },
        "increment": {
          "type": "integer"
        },
        "minValue": {
          "type": "integer"
        },
        "maxValue": {
          "type": "integer"
        },
        "cycle": {
          "type": "boolean"
        },
        "cache": {
          "type": "integer"
        },
        "ownedBy": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "Function": {
      "type": "object",
      "description": "A stored database function that encapsulates reusable computation logic. Returns a value and can be used in SQL expressions for data transformation or validation.",
      "required": [
        "id",
        "name",
        "language",
        "returnType"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "schema": {
          "type": "string",
          "minLength": 1
        },
        "language": {
          "$ref": "#/definitions/FunctionLanguage"
        },
        "returnType": {
          "type": "string",
          "minLength": 1
        },
        "volatility": {
          "$ref": "#/definitions/FunctionVolatility"
        },
        "parallel": {
          "$ref": "#/definitions/ParallelSafety"
        },
        "strict": {
          "type": "boolean"
        },
        "security": {
          "$ref": "#/definitions/SecurityDefiner"
        },
        "cost": {
          "type": "integer"
        },
        "rows": {
          "type": "integer"
        }
      }
    }
  }
}
