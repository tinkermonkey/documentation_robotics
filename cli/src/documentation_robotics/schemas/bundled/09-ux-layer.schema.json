{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/09-ux-layer.json",
  "title": "UX Layer Schema",
  "description": "Custom user experience specification for multi-channel state management and behavior",
  "type": "object",
  "required": ["version", "experience", "channel", "states", "views"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Specification version"
    },
    "experience": {
      "type": "string",
      "description": "Experience identifier"
    },
    "channel": {
      "type": "string",
      "enum": ["visual", "voice", "chat", "sms", "multimodal"],
      "description": "Primary channel for this experience"
    },
    "title": {
      "type": "string"
    },
    "description": {
      "type": "string"
    },
    "application": {
      "type": "string",
      "format": "uuid",
      "description": "Reference to Application entity"
    },
    "archimateElement": {
      "type": "string",
      "format": "uuid",
      "description": "Reference to ApplicationComponent"
    },
    "dataSchema": {
      "type": "string",
      "description": "Path to JSON Schema file"
    },
    "apiSpec": {
      "type": "string",
      "description": "Path to OpenAPI spec file"
    },
    "motivationAlignment": {
      "type": "object",
      "properties": {
        "supportsGoals": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Goal IDs this experience helps achieve"
        },
        "deliversValue": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Value IDs this experience provides"
        },
        "governedByPrinciples": {
          "type": "array",
          "items": { "type": "string" },
          "description": "UX/Design Principle IDs"
        },
        "fulfillsRequirements": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Requirement IDs this experience fulfills"
        }
      }
    },
    "business": {
      "type": "object",
      "properties": {
        "supportsProcesses": {
          "type": "array",
          "items": { "type": "string" },
          "description": "BusinessProcess IDs this experience supports"
        },
        "realizesServices": {
          "type": "array",
          "items": { "type": "string" },
          "description": "BusinessService IDs this experience realizes"
        },
        "targetActors": {
          "type": "array",
          "items": { "type": "string" },
          "description": "BusinessActor IDs this experience is designed for"
        },
        "targetRoles": {
          "type": "array",
          "items": { "type": "string" },
          "description": "BusinessRole IDs this experience is designed for"
        }
      }
    },
    "security": {
      "type": "object",
      "properties": {
        "model": {
          "type": "string",
          "description": "SecurityModel reference"
        },
        "defaultRequiredRoles": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Default roles required for this experience"
        }
      }
    },
    "apm": {
      "type": "object",
      "properties": {
        "measuredByMetrics": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Metric names that measure this experience"
        },
        "performanceTargets": {
          "$ref": "#/definitions/PerformanceTargets"
        }
      }
    },
    "states": {
      "type": "array",
      "items": { "$ref": "#/definitions/ExperienceState" },
      "minItems": 1
    },
    "views": {
      "type": "array",
      "items": { "$ref": "#/definitions/View" },
      "minItems": 1
    },
    "globalActions": {
      "type": "array",
      "items": { "$ref": "#/definitions/ActionComponent" }
    }
  },
  "definitions": {
    "ExperienceState": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string"
        },
        "initial": {
          "type": "boolean",
          "default": false
        },
        "description": {
          "type": "string"
        },
        "channel": {
          "type": "string",
          "enum": ["visual", "voice", "chat", "sms", "multimodal"],
          "description": "Channel-specific state (optional)"
        },
        "onEnter": {
          "type": "array",
          "items": { "$ref": "#/definitions/StateAction" }
        },
        "onExit": {
          "type": "array",
          "items": { "$ref": "#/definitions/StateAction" }
        },
        "transitions": {
          "type": "array",
          "items": { "$ref": "#/definitions/StateTransition" }
        },
        "enabledComponents": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Component names to enable"
        },
        "disabledComponents": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Component names to disable"
        },
        "hiddenComponents": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Component names to hide"
        }
      }
    },
    "StateAction": {
      "type": "object",
      "required": ["action"],
      "properties": {
        "action": {
          "type": "string",
          "enum": ["fetchData", "saveData", "deleteData", "validateForm", "clearForm", "showNotification", "navigateTo", "callAPI", "updateState", "computeValue"]
        },
        "description": {
          "type": "string"
        },
        "api": {
          "type": "object",
          "properties": {
            "operationId": {
              "type": "string",
              "description": "OpenAPI operationId"
            },
            "method": {
              "type": "string",
              "enum": ["GET", "POST", "PUT", "DELETE", "PATCH"]
            },
            "endpoint": {
              "type": "string",
              "format": "uri"
            }
          }
        },
        "data": {
          "type": "object",
          "properties": {
            "source": {
              "type": "string",
              "enum": ["api-response", "form-data", "route-params", "query-params", "local-storage", "constant", "computed"]
            },
            "target": {
              "type": "string",
              "description": "JSONPath to target location"
            },
            "transform": {
              "type": "string",
              "description": "Transformation expression"
            }
          }
        },
        "errorHandling": {
          "type": "object",
          "properties": {
            "onError": {
              "type": "string",
              "description": "Target state on error"
            },
            "showNotification": {
              "type": "boolean",
              "default": true
            },
            "errorMessage": {
              "type": "string"
            }
          }
        }
      }
    },
    "StateTransition": {
      "type": "object",
      "required": ["to", "on"],
      "properties": {
        "to": {
          "type": "string",
          "description": "Target ExperienceState name"
        },
        "on": {
          "type": "string",
          "enum": ["success", "failure", "submit", "cancel", "click", "timeout", "dataReady", "custom"]
        },
        "description": {
          "type": "string"
        },
        "condition": {
          "$ref": "#/definitions/Condition"
        },
        "validate": {
          "type": "boolean",
          "default": false
        },
        "actions": {
          "type": "array",
          "items": { "$ref": "#/definitions/StateAction" }
        }
      }
    },
    "Condition": {
      "type": "object",
      "required": ["expression"],
      "properties": {
        "expression": {
          "type": "string",
          "description": "JavaScript-like boolean expression"
        },
        "description": {
          "type": "string"
        }
      }
    },
    "View": {
      "type": "object",
      "required": ["name", "type"],
      "properties": {
        "name": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["form", "list", "detail", "dashboard", "wizard", "split", "conversational", "custom"]
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "routable": {
          "type": "boolean",
          "default": true
        },
        "route": {
          "type": "string",
          "description": "Route identifier from Navigation Layer"
        },
        "layout": {
          "$ref": "#/definitions/LayoutStyle"
        },
        "subViews": {
          "type": "array",
          "items": { "$ref": "#/definitions/SubView" }
        },
        "components": {
          "type": "array",
          "items": { "$ref": "#/definitions/Component" }
        },
        "actions": {
          "type": "array",
          "items": { "$ref": "#/definitions/ActionComponent" }
        },
        "security": {
          "type": "object",
          "properties": {
            "resourceRef": {
              "type": "string",
              "description": "SecureResource reference - type must be 'screen'"
            },
            "requiredRoles": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Roles required to access this view"
            },
            "requiredPermissions": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Permissions required to access this view"
            }
          }
        }
      }
    },
    "LayoutStyle": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["grid", "flex", "stack", "flow", "custom"]
        },
        "columns": {
          "type": "integer",
          "minimum": 1
        },
        "gap": {
          "type": "string"
        }
      }
    },
    "SubView": {
      "type": "object",
      "required": ["name", "title"],
      "properties": {
        "name": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "collapsible": {
          "type": "boolean",
          "default": false
        },
        "collapsed": {
          "type": "boolean",
          "default": false
        },
        "layout": {
          "$ref": "#/definitions/LayoutStyle"
        },
        "order": {
          "type": "integer"
        },
        "components": {
          "type": "array",
          "items": { "$ref": "#/definitions/Component" }
        },
        "subViews": {
          "type": "array",
          "items": { "$ref": "#/definitions/SubView" }
        },
        "conditionalDisplay": {
          "$ref": "#/definitions/Condition"
        }
      }
    },
    "Component": {
      "type": "object",
      "required": ["name", "type"],
      "properties": {
        "name": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["form-field", "table", "chart", "card", "list", "text", "image", "video", "audio", "map", "calendar", "timeline", "tree", "custom"]
        },
        "label": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "required": {
          "type": "boolean",
          "default": false
        },
        "readonly": {
          "type": "boolean",
          "default": false
        },
        "hidden": {
          "type": "boolean",
          "default": false
        },
        "order": {
          "type": "integer"
        },
        "dataBinding": {
          "type": "object",
          "properties": {
            "schemaRef": {
              "type": "string",
              "description": "JSONPath to property in JSON Schema"
            },
            "defaultValue": {},
            "dataSource": {
              "type": "string",
              "description": "API operation ID or data reference"
            }
          }
        },
        "config": {
          "type": "object",
          "description": "Component-specific configuration",
          "oneOf": [
            { "$ref": "#/definitions/FormFieldConfig" },
            { "$ref": "#/definitions/TableConfig" },
            { "$ref": "#/definitions/ChartConfig" },
            { "$ref": "#/definitions/AudioConfig" },
            { "$ref": "#/definitions/CustomConfig" }
          ]
        },
        "conditionalDisplay": {
          "$ref": "#/definitions/Condition"
        },
        "security": {
          "type": "object",
          "properties": {
            "fieldAccess": {
              "type": "string",
              "description": "Field name in SecureResource for field-level access control"
            },
            "visibleToRoles": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Roles that can see this component"
            },
            "editableByRoles": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Roles that can edit this component"
            }
          }
        },
        "dependsOn": {
          "type": "array",
          "items": { "type": "string" }
        },
        "triggers": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "PerformanceTargets": {
      "type": "object",
      "properties": {
        "loadTimeMs": {
          "type": "integer",
          "minimum": 0,
          "description": "Target load time in milliseconds"
        },
        "interactionLatencyMs": {
          "type": "integer",
          "minimum": 0,
          "description": "Target interaction latency in milliseconds"
        },
        "errorRatePercent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Target error rate percentage"
        },
        "completionRatePercent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Target completion rate percentage"
        }
      }
    },
    "FormFieldConfig": {
      "type": "object",
      "required": ["fieldType"],
      "properties": {
        "fieldType": {
          "type": "string",
          "enum": ["text-input", "textarea", "number-input", "email-input", "password-input", "url-input", "phone-input", "date-picker", "datetime-picker", "time-picker", "select", "multi-select", "autocomplete", "checkbox", "radio-group", "toggle", "slider", "file-upload", "image-upload", "rich-text-editor", "markdown-editor", "color-picker", "rating", "tags-input"]
        },
        "placeholder": {
          "type": "string"
        },
        "helpText": {
          "type": "string"
        },
        "validation": {
          "type": "array",
          "items": { "$ref": "#/definitions/ValidationRule" }
        },
        "props": {
          "type": "object"
        }
      }
    },
    "TableConfig": {
      "type": "object",
      "properties": {
        "sortable": {
          "type": "boolean"
        },
        "filterable": {
          "type": "boolean"
        },
        "paginated": {
          "type": "boolean"
        },
        "selectable": {
          "type": "boolean"
        }
      }
    },
    "ChartConfig": {
      "type": "object",
      "properties": {
        "chartType": {
          "type": "string",
          "enum": ["line", "bar", "pie", "scatter", "area", "custom"]
        },
        "xAxis": {
          "type": "string"
        },
        "yAxis": {
          "type": "string"
        }
      }
    },
    "AudioConfig": {
      "type": "object",
      "properties": {
        "audioType": {
          "type": "string",
          "enum": ["speech", "recorded", "stream"]
        },
        "text": {
          "type": "string",
          "description": "Text for text-to-speech"
        },
        "audioUrl": {
          "type": "string",
          "format": "uri"
        },
        "voice": {
          "type": "string"
        }
      }
    },
    "CustomConfig": {
      "type": "object",
      "properties": {
        "componentClass": {
          "type": "string"
        },
        "props": {
          "type": "object"
        }
      }
    },
    "ValidationRule": {
      "type": "object",
      "required": ["type", "message"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["required", "minLength", "maxLength", "pattern", "email", "url", "min", "max", "custom"]
        },
        "message": {
          "type": "string"
        },
        "value": {
          "description": "Rule-specific value"
        }
      }
    },
    "ActionComponent": {
      "type": "object",
      "required": ["name", "label", "type", "action"],
      "properties": {
        "name": {
          "type": "string"
        },
        "label": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["button", "menu-item", "link", "voice-command", "chat-button", "sms-keyword", "custom"]
        },
        "icon": {
          "type": "string"
        },
        "disabled": {
          "type": "boolean",
          "default": false
        },
        "tooltip": {
          "type": "string"
        },
        "channel": {
          "type": "string",
          "enum": ["visual", "voice", "chat", "sms", "multimodal"],
          "description": "Channel-specific action (optional)"
        },
        "action": {
          "$ref": "#/definitions/StateAction"
        },
        "confirmationPrompt": {
          "type": "string"
        },
        "enableCondition": {
          "$ref": "#/definitions/Condition"
        },
        "children": {
          "type": "array",
          "items": { "$ref": "#/definitions/ActionComponent" },
          "description": "Nested actions for menus"
        }
      }
    }
  }
}
