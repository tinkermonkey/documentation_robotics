{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://documentation-robotics.org/schemas/common/layer-extensions.schema.json",
  "title": "Layer Schema Extensions",
  "description": "Definitions for intraLayerRelationships and crossLayerRelationships sections in layer schemas",
  "version": "1.0.0",

  "definitions": {
    "layerMetadata": {
      "type": "object",
      "description": "Metadata about the layer and its relationship support",
      "properties": {
        "layerId": {
          "type": "string",
          "pattern": "^\\d{2}-[a-z-]+$",
          "description": "Layer identifier (e.g., '12-testing')"
        },
        "layerName": {
          "type": "string",
          "description": "Human-readable layer name"
        },
        "intraLayerRelationshipSupport": {
          "type": "boolean",
          "description": "Whether this layer supports relationships between its own entities"
        },
        "crossLayerRelationshipSupport": {
          "type": "boolean",
          "description": "Whether this layer supports relationships to/from other layers"
        },
        "relationshipCatalogVersion": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Version of relationship-catalog.json this layer is aligned with"
        }
      },
      "required": ["layerId", "layerName", "relationshipCatalogVersion"],
      "additionalProperties": false
    },

    "relationshipExample": {
      "type": "object",
      "description": "Example of a relationship between two elements",
      "properties": {
        "source": {
          "type": "string",
          "description": "Source element type or ID"
        },
        "target": {
          "type": "string",
          "description": "Target element type or ID"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of this relationship instance"
        }
      },
      "required": ["source", "target", "description"],
      "additionalProperties": false
    },

    "intraLayerRelationship": {
      "type": "object",
      "description": "Definition of an allowed relationship within this layer",
      "properties": {
        "relationshipTypeId": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "ID from relationship-catalog.json (e.g., 'composition', 'aggregation')"
        },
        "sourceTypes": {
          "type": "array",
          "items": {
            "type": "string",
            "description": "Element type name (e.g., 'TestCoverageModel')"
          },
          "minItems": 1,
          "description": "Element types that can be the source of this relationship"
        },
        "targetTypes": {
          "type": "array",
          "items": {
            "type": "string",
            "description": "Element type name (e.g., 'TestCoverageTarget')"
          },
          "minItems": 1,
          "description": "Element types that can be the target of this relationship"
        },
        "examples": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/relationshipExample"
          },
          "minItems": 1,
          "description": "Example usages of this relationship within the layer"
        }
      },
      "required": ["relationshipTypeId", "sourceTypes", "targetTypes"],
      "additionalProperties": false
    },

    "crossLayerRelationshipExample": {
      "type": "object",
      "description": "Example of a cross-layer relationship",
      "properties": {
        "source": {
          "type": "string",
          "description": "Source element ID or type"
        },
        "sourceType": {
          "type": "string",
          "description": "Source element type name"
        },
        "target": {
          "type": "string",
          "description": "Target element ID or type"
        },
        "targetType": {
          "type": "string",
          "description": "Target element type name"
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of this relationship"
        }
      },
      "required": ["source", "sourceType", "target", "targetType", "description"],
      "additionalProperties": false
    },

    "crossLayerRelationship": {
      "type": "object",
      "description": "Definition of a cross-layer relationship",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Unique identifier for this relationship type (kebab-case)"
        },
        "predicate": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Forward direction predicate (e.g., 'supports-goals', 'realizes')"
        },
        "inversePredicate": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9-]*$",
          "description": "Reverse direction predicate (e.g., 'supported-by', 'realized-by')"
        },
        "targetLayer": {
          "type": "string",
          "pattern": "^\\d{2}-[a-z-]+$",
          "description": "Target layer ID (e.g., '01-motivation')"
        },
        "targetTypes": {
          "type": "array",
          "items": {
            "type": "string",
            "description": "Element type name in target layer"
          },
          "minItems": 1,
          "description": "Element types in target layer this relationship can point to"
        },
        "sourceTypes": {
          "type": "array",
          "items": {
            "type": "string",
            "description": "Element type name in source layer"
          },
          "description": "Element types in this layer that can have this relationship (optional for incoming)"
        },
        "fieldPath": {
          "type": "string",
          "pattern": "^([a-z][a-zA-Z0-9]*\\.[a-z][a-z0-9-]*|x-[a-z][a-z0-9-]*)$",
          "description": "Property path that encodes this relationship (e.g., 'motivation.supports-goals')"
        },
        "cardinality": {
          "type": "string",
          "enum": ["single", "array"],
          "description": "Whether this relationship is one-to-one or one-to-many"
        },
        "format": {
          "type": "string",
          "enum": ["uuid", "id", "string", "duration", "percentage", "path", "enum"],
          "description": "Expected format of the relationship value"
        },
        "strength": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"],
          "description": "Importance/strength of this relationship"
        },
        "required": {
          "type": "boolean",
          "description": "Whether this relationship is mandatory for the source element"
        },
        "description": {
          "type": "string",
          "minLength": 10,
          "description": "Clear description of what this relationship represents"
        },
        "examples": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/crossLayerRelationshipExample"
          },
          "description": "Example usages of this cross-layer relationship"
        }
      },
      "required": ["id", "predicate", "inversePredicate", "targetLayer", "targetTypes", "fieldPath", "cardinality", "format", "description"],
      "additionalProperties": false
    },

    "intraLayerRelationships": {
      "type": "object",
      "description": "Relationships between entities within this layer",
      "properties": {
        "$comment": {
          "type": "string"
        },
        "allowed": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/intraLayerRelationship"
          },
          "description": "List of allowed relationship types within this layer"
        }
      },
      "required": ["allowed"],
      "additionalProperties": false
    },

    "crossLayerRelationships": {
      "type": "object",
      "description": "Relationships to/from entities in other layers",
      "properties": {
        "$comment": {
          "type": "string"
        },
        "outgoing": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/crossLayerRelationship"
          },
          "description": "Relationships FROM this layer TO other layers"
        },
        "incoming": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/crossLayerRelationship"
          },
          "description": "Relationships TO this layer FROM other layers"
        }
      },
      "additionalProperties": false
    }
  }
}
