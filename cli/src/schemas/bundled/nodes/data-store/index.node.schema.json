{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Index",
  "description": "A database index for query optimization. Paradigm-neutral: covers B-tree and hash indexes (relational), compound and multikey indexes (document stores), vector approximate nearest neighbor indexes (HNSW, IVF), inverted indexes (search engines), geospatial indexes, and secondary indexes (wide-column stores).",
  "allOf": [
    {
      "$ref": "../../base/spec-node.schema.json"
    }
  ],
  "properties": {
    "spec_node_id": {
      "const": "data-store.index"
    },
    "layer_id": {
      "const": "data-store"
    },
    "type": {
      "const": "index"
    },
    "attributes": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string"
        },
        "fields": {
          "type": "string",
          "description": "Field name(s) included in the index key."
        },
        "unique": {
          "type": "boolean"
        },
        "method": {
          "type": "string",
          "enum": [
            "BTREE",
            "HASH",
            "GIN",
            "GIST",
            "SPGIST",
            "BRIN",
            "HNSW",
            "IVF_FLAT",
            "IVF_PQ",
            "ANNOY",
            "LSH",
            "INVERTED",
            "FULLTEXT",
            "GEOSPATIAL",
            "COMPOUND",
            "MULTIKEY",
            "CUSTOM"
          ],
          "description": "Index access method. BTREE/HASH: traditional ordered and hash-based (relational, document). GIN/GIST/SPGIST/BRIN: PostgreSQL advanced index types. HNSW/IVF_FLAT/IVF_PQ/ANNOY/LSH: vector approximate nearest neighbor algorithms. INVERTED/FULLTEXT: search engine and full-text indexes. GEOSPATIAL: location-based spatial indexes. COMPOUND/MULTIKEY: document store compound and array indexes. CUSTOM: engine-specific method not listed."
        },
        "where": {
          "type": "string",
          "description": "Partial or filtered index predicate. Only entries satisfying this condition are indexed. Supported by relational (PostgreSQL, SQL Server) and document stores (MongoDB partial index filter)."
        },
        "include": {
          "type": "string",
          "description": "Covering index: additional fields stored in the index but not in the search key. Reduces lookups by including frequently accessed fields in the index leaf pages."
        },
        "sparse": {
          "type": "boolean",
          "description": "Whether the index only includes entries where the indexed field exists. Relevant for document stores with flexible schemas and sparse datasets."
        },
        "vectorConfig": {
          "type": "object",
          "description": "Configuration parameters for vector indexes. Only applicable when method is HNSW, IVF_FLAT, IVF_PQ, ANNOY, or LSH.",
          "properties": {
            "dimensions": {
              "type": "integer",
              "description": "Number of dimensions in the vector space."
            },
            "distanceMetric": {
              "type": "string",
              "enum": ["COSINE", "EUCLIDEAN", "DOT_PRODUCT", "MANHATTAN"],
              "description": "Distance metric for similarity computation."
            },
            "efConstruction": {
              "type": "integer",
              "description": "HNSW build-time parameter controlling index quality vs. build speed tradeoff."
            },
            "m": {
              "type": "integer",
              "description": "HNSW maximum number of connections per node in the graph."
            },
            "nlist": {
              "type": "integer",
              "description": "IVF number of clusters (Voronoi cells) for partitioning the vector space."
            }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    }
  }
}
