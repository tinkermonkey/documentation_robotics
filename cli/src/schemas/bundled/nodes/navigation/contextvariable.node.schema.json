{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ContextVariable",
  "description": "A typed variable shared across steps of a NavigationFlow, enabling state to persist and transfer between route transitions.",
  "allOf": [
    {
      "$ref": "../../base/spec-node.schema.json"
    }
  ],
  "properties": {
    "spec_node_id": {
      "const": "navigation.contextvariable"
    },
    "layer_id": {
      "const": "navigation"
    },
    "type": {
      "const": "contextvariable"
    },
    "attributes": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string"
        },
        "schemaRef": {
          "type": "string"
        },
        "scope": {
          "type": "string",
          "enum": ["global", "flow", "step", "session"],
          "description": "Lifetime and visibility of the variable across navigation flow execution."
        },
        "persistedIn": {
          "type": "string",
          "enum": ["sessionStorage", "localStorage", "memory", "url-param"],
          "description": "Storage mechanism used to persist the variable across route transitions: sessionStorage (browser session), localStorage (cross-session), memory (in-process only), url-param (serialized into the URL query string)."
        },
        "defaultValue": {
          "type": "string"
        },
        "required": {
          "type": "boolean",
          "description": "When true, the flow cannot proceed if this variable is unset or null. Used to enforce mandatory input collection before advancing to dependent steps."
        }
      },
      "required": ["schemaRef", "scope", "persistedIn"],
      "additionalProperties": false
    }
  }
}
