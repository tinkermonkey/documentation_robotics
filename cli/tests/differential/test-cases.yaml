# Comprehensive Differential Test Cases
# Comparing Python CLI (dr) with TypeScript CLI (dr)
#
# Test Strategy:
# 1. Compare commands that exist in both CLIs
# 2. Use same test model for consistency
# 3. Compare exit codes and output where possible

# Common paths
python_cli: &python_cli /Users/austinsand/workspace/documentation_robotics/.venv/bin/dr
typescript_cli_root: &ts_root /Users/austinsand/workspace/documentation_robotics/cli
# Use Python CLI-compatible baseline model (has documentation-robotics/ subdirectory)
baseline_model: &baseline_model /Users/austinsand/workspace/documentation_robotics/cli-validation/test-project/baseline
temp_test_dir: &temp_dir /tmp/dr-differential-test

test_cases:
  # ============================================================================
  # VALIDATION TESTS
  # ============================================================================

  - name: "Validate - default (all validations)"
    description: "Run complete model validation"
    python:
      command: *python_cli
      args: ["validate"]
      cwd: *baseline_model
      timeout: 60000
    typescript:
      command: "bun"
      args: ["run", "src/cli.ts", "validate", "--model", *baseline_model]
      cwd: *ts_root
      timeout: 60000
    comparison:
      type: "exit-code"
    skip: false
    expectedToFail: true

  - name: "Validate - with strict mode"
    description: "Validate with warnings as errors"
    python:
      command: *python_cli
      args: ["validate", "--strict"]
      cwd: *baseline_model
      timeout: 30000
    typescript:
      command: "bun"
      args: ["run", "src/cli.ts", "validate", "--strict", "--model", *baseline_model]
      cwd: *ts_root
      timeout: 30000
    comparison:
      type: "exit-code"
    skip: false

  # ============================================================================
  # EXPORT TESTS
  # ============================================================================

  - name: "Export - GraphML format"
    description: "Export model as GraphML"
    python:
      command: *python_cli
      args: ["export", "--format", "graphml", "--output", "/tmp/python-export.graphml"]
      cwd: *baseline_model
      timeout: 30000
    typescript:
      command: "bun"
      args:
        [
          "run",
          "src/cli.ts",
          "export",
          "graphml",
          "--output",
          "/tmp/ts-export.graphml",
          "--model",
          *baseline_model,
        ]
      cwd: *ts_root
      timeout: 30000
    comparison:
      type: "exit-code"
    skip: false

  # Note: Python CLI doesn't support JSON export format
  # - name: "Export - JSON format"
  #   description: "Export complete model as JSON"
  #   python:
  #     command: "dr"
  #     args: ["export", "--format", "json", "--output", "/tmp/python-export.json"]
  #     cwd: *baseline_model
  #     timeout: 30000
  #   typescript:
  #     command: "bun"
  #     args: ["run", "src/cli.ts", "export", "json", "--output", "/tmp/ts-export.json", "--model", *baseline_model]
  #     cwd: *ts_root
  #     timeout: 30000
  #   comparison:
  #     type: "exit-code"
  #   skip: false

  - name: "Export - Markdown format"
    description: "Export model documentation as Markdown"
    python:
      command: *python_cli
      args: ["export", "--format", "markdown", "--output", "/tmp/python-export"]
      cwd: *baseline_model
      timeout: 30000
    typescript:
      command: "bun"
      args:
        [
          "run",
          "src/cli.ts",
          "export",
          "markdown",
          "--output",
          "/tmp/ts-export.md",
          "--model",
          *baseline_model,
        ]
      cwd: *ts_root
      timeout: 30000
    comparison:
      type: "exit-code"
    skip: false

  # ============================================================================
  # LIST/SEARCH TESTS
  # ============================================================================

  - name: "List - business layer elements"
    description: "List all elements in business layer"
    python:
      command: *python_cli
      args: ["list", "business"]
      cwd: *baseline_model
      timeout: 10000
    typescript:
      command: "bun"
      args: ["run", "src/cli.ts", "list", "business", "--model", *baseline_model]
      cwd: *ts_root
      timeout: 10000
    comparison:
      type: "exit-code"
    skip: false

  - name: "List - motivation layer elements"
    description: "List all elements in motivation layer"
    python:
      command: *python_cli
      args: ["list", "motivation"]
      cwd: *baseline_model
      timeout: 10000
    typescript:
      command: "bun"
      args: ["run", "src/cli.ts", "list", "motivation", "--model", *baseline_model]
      cwd: *ts_root
      timeout: 10000
    comparison:
      type: "exit-code"
    skip: false

  - name: "Search - by keyword"
    description: "Search for elements containing 'visualization'"
    python:
      command: *python_cli
      args: ["search", "visualization"]
      cwd: *baseline_model
      timeout: 10000
    typescript:
      command: "bun"
      args: ["run", "src/cli.ts", "search", "visualization", "--model", *baseline_model]
      cwd: *ts_root
      timeout: 10000
    comparison:
      type: "exit-code"
    skip: false
    expectedToFail: true

  # ============================================================================
  # SHOW/FIND TESTS (different command names)
  # ============================================================================

  - name: "Show/Find - specific element"
    description: "Display details of specific element (find vs show)"
    python:
      command: *python_cli
      args: ["find", "business.service.model-data-management"]
      cwd: *baseline_model
      timeout: 10000
    typescript:
      command: "bun"
      args:
        [
          "run",
          "src/cli.ts",
          "show",
          "business.service.model-data-management",
          "--model",
          *baseline_model,
        ]
      cwd: *ts_root
      timeout: 10000
    comparison:
      type: "exit-code"
    skip: false

  # ============================================================================
  # TRACE TESTS
  # ============================================================================

  - name: "Trace - element dependencies"
    description: "Trace dependencies for specific element"
    python:
      command: *python_cli
      args: ["trace", "business.service.model-data-management"]
      cwd: *baseline_model
      timeout: 15000
    typescript:
      command: "bun"
      args:
        [
          "run",
          "src/cli.ts",
          "trace",
          "business.service.model-data-management",
          "--model",
          *baseline_model,
        ]
      cwd: *ts_root
      timeout: 15000
    comparison:
      type: "exit-code"
    skip: false

  - name: "Trace - with depth limit"
    description: "Trace dependencies with maximum depth of 2"
    python:
      command: *python_cli
      args: ["trace", "business.service.model-data-management", "--depth", "2"]
      cwd: *baseline_model
      timeout: 15000
    typescript:
      command: "bun"
      args:
        [
          "run",
          "src/cli.ts",
          "trace",
          "business.service.model-data-management",
          "--depth",
          "2",
          "--model",
          *baseline_model,
        ]
      cwd: *ts_root
      timeout: 15000
    comparison:
      type: "exit-code"
    skip: false
    expectedToFail: true

  # ============================================================================
  # CONFORMANCE TESTS
  # ============================================================================

  - name: "Conformance - check all layers"
    description: "Check model conformance to layer specifications"
    python:
      command: *python_cli
      args: ["conformance"]
      cwd: *baseline_model
      timeout: 30000
    typescript:
      command: "bun"
      args: ["run", "src/cli.ts", "conformance", "--model", *baseline_model]
      cwd: *ts_root
      timeout: 30000
    comparison:
      type: "exit-code"
    skip: false
    expectedToFail: true

  - name: "Conformance - specific layer"
    description: "Check conformance for business layer only"
    python:
      command: *python_cli
      args: ["conformance", "--layer", "business"]
      cwd: *baseline_model
      timeout: 30000
    typescript:
      command: "bun"
      args: ["run", "src/cli.ts", "conformance", "--layer", "business", "--model", *baseline_model]
      cwd: *ts_root
      timeout: 30000
    comparison:
      type: "exit-code"
    skip: false
    expectedToFail: true

  # ============================================================================
  # VERSION/INFO TESTS
  # ============================================================================

  - name: "Version - show CLI version"
    description: "Display CLI version information"
    python:
      command: *python_cli
      args: ["version"]
      cwd: *baseline_model
      timeout: 5000
    typescript:
      command: "bun"
      args: ["run", "src/cli.ts", "version"]
      cwd: *ts_root
      timeout: 5000
    comparison:
      type: "exit-code"
    skip: false

  - name: "Upgrade - check for upgrades (dry-run)"
    description: "Check for available upgrades without modifying files"
    python:
      command: *python_cli
      args: ["update", "--dry-run"]
      cwd: *baseline_model
      timeout: 10000
    typescript:
      command: "bun"
      args: ["run", "src/cli.ts", "upgrade", "--dry-run"]
      cwd: *ts_root
      timeout: 10000
    comparison:
      type: "exit-code"
    skip: false
    expectedToFail: true
    notes: "Python CLI uses 'update' command, TypeScript uses 'upgrade'. Output format may differ."

  # ============================================================================
  # ERROR HANDLING TESTS
  # ============================================================================

  - name: "Error - invalid model path"
    description: "Should fail gracefully with invalid model path"
    python:
      command: *python_cli
      args: ["validate"]
      cwd: /tmp/nonexistent-model
      timeout: 5000
    typescript:
      command: "bun"
      args: ["run", "src/cli.ts", "validate", "--model", "/tmp/nonexistent-model"]
      cwd: *ts_root
      timeout: 5000
    comparison:
      type: "exit-code"
    skip: false
    expectedToFail: true

  - name: "Error - invalid element ID in show/find"
    description: "Should fail when element doesn't exist"
    python:
      command: *python_cli
      args: ["find", "nonexistent.element.id"]
      cwd: *baseline_model
      timeout: 5000
    typescript:
      command: "bun"
      args: ["run", "src/cli.ts", "show", "nonexistent.element.id", "--model", *baseline_model]
      cwd: *ts_root
      timeout: 5000
    comparison:
      type: "exit-code"
    skip: false
    expectedToFail: true

  - name: "Error - invalid layer name in list"
    description: "Should fail with invalid layer name"
    python:
      command: *python_cli
      args: ["list", "invalid-layer-name"]
      cwd: *baseline_model
      timeout: 5000
    typescript:
      command: "bun"
      args: ["run", "src/cli.ts", "list", "invalid-layer-name", "--model", *baseline_model]
      cwd: *ts_root
      timeout: 5000
    comparison:
      type: "exit-code"
    skip: false
    expectedToFail: true

  # ============================================================================
  # WRITE OPERATION TESTS
  # These tests verify that both CLIs create identical filesystem changes
  # ============================================================================

  - name: "Add - create element with auto-generated ID"
    description: "Verify both CLIs generate same element ID format from name"
    python:
      command: *python_cli
      args: ["--no-upgrade-check", "add", "motivation", "goal", "--name", "Test Goal"]
      cwd: "/tmp/dr-test-python"
      setup:
        - [
            "/bin/sh",
            "-c",
            "rm -rf /tmp/dr-test-python && mkdir -p /tmp/dr-test-python && cd /tmp/dr-test-python && /Users/austinsand/workspace/documentation_robotics/.venv/bin/dr --no-upgrade-check init --name 'Test Project' --description 'Test' --author 'Test'",
          ]
      timeout: 10000
    typescript:
      command: "bun"
      args:
        [
          "run",
          "/Users/austinsand/workspace/documentation_robotics/cli/src/cli.ts",
          "add",
          "motivation",
          "goal",
          "Test Goal",
        ]
      cwd: "/tmp/dr-test-typescript"
      setup:
        - [
            "/bin/sh",
            "-c",
            "rm -rf /tmp/dr-test-typescript && mkdir -p /tmp/dr-test-typescript && cd /tmp/dr-test-typescript && bun run /Users/austinsand/workspace/documentation_robotics/cli/src/cli.ts init --name 'Test Project' --description 'Test' --author 'Test'",
          ]
      timeout: 10000
    comparison:
      type: "filesystem"
      pythonRoot: "/tmp/dr-test-python/documentation-robotics/model"
      typescriptRoot: "/tmp/dr-test-typescript/documentation-robotics/model"
      paths: ["**/*.yaml"]
    skip: false
    expectedToFail: true

  - name: "Add - create element with special characters in name"
    description: "Verify kebab-case conversion matches between CLIs"
    python:
      command: *python_cli
      args:
        ["--no-upgrade-check", "add", "business", "capability", "--name", "User Management & Auth"]
      cwd: "/tmp/dr-test-python"
      timeout: 10000
    typescript:
      command: "bun"
      args:
        [
          "run",
          "/Users/austinsand/workspace/documentation_robotics/cli/src/cli.ts",
          "add",
          "business",
          "capability",
          "User Management & Auth",
        ]
      cwd: "/tmp/dr-test-typescript"
      timeout: 10000
    comparison:
      type: "filesystem"
      pythonRoot: "/tmp/dr-test-python/documentation-robotics/model"
      typescriptRoot: "/tmp/dr-test-typescript/documentation-robotics/model"
      paths: ["**/*.yaml"]
    skip: false
    expectedToFail: true

  - name: "Add - multiple elements in same layer"
    description: "Verify consistent ID generation for multiple elements"
    python:
      command: *python_cli
      args: ["--no-upgrade-check", "add", "motivation", "goal", "--name", "Second Goal"]
      cwd: "/tmp/dr-test-python"
      setup:
        - [
            "/bin/sh",
            "-c",
            "cd /tmp/dr-test-python && /Users/austinsand/workspace/documentation_robotics/.venv/bin/dr --no-upgrade-check add motivation goal --name 'First Goal'",
          ]
      timeout: 10000
    typescript:
      command: "bun"
      args:
        [
          "run",
          "/Users/austinsand/workspace/documentation_robotics/cli/src/cli.ts",
          "add",
          "motivation",
          "goal",
          "Second Goal",
        ]
      cwd: "/tmp/dr-test-typescript"
      setup:
        - [
            "/bin/sh",
            "-c",
            "cd /tmp/dr-test-typescript && bun run /Users/austinsand/workspace/documentation_robotics/cli/src/cli.ts add motivation goal 'First Goal'",
          ]
      timeout: 10000
    comparison:
      type: "filesystem"
      pythonRoot: "/tmp/dr-test-python/documentation-robotics/model"
      typescriptRoot: "/tmp/dr-test-typescript/documentation-robotics/model"
      paths: ["**/*.yaml"]
    skip: false
    expectedToFail: true

  - name: "Update - modify element properties"
    description: "Verify update command produces identical results"
    python:
      command: *python_cli
      args:
        [
          "--no-upgrade-check",
          "update",
          "motivation.goal.test-goal",
          "--name",
          "Updated Goal",
          "--description",
          "New description",
        ]
      cwd: "/tmp/dr-test-python"
      setup:
        - [
            "/bin/sh",
            "-c",
            "cd /tmp/dr-test-python && /Users/austinsand/workspace/documentation_robotics/.venv/bin/dr --no-upgrade-check add motivation goal --name 'Test Goal'",
          ]
      timeout: 10000
    typescript:
      command: "bun"
      args:
        [
          "run",
          "/Users/austinsand/workspace/documentation_robotics/cli/src/cli.ts",
          "update",
          "motivation.goal.test-goal",
          "--name",
          "Updated Goal",
          "--description",
          "New description",
        ]
      cwd: "/tmp/dr-test-typescript"
      setup:
        - [
            "/bin/sh",
            "-c",
            "cd /tmp/dr-test-typescript && bun run /Users/austinsand/workspace/documentation_robotics/cli/src/cli.ts add motivation goal 'Test Goal'",
          ]
      timeout: 10000
    comparison:
      type: "filesystem"
      pythonRoot: "/tmp/dr-test-python/documentation-robotics/model"
      typescriptRoot: "/tmp/dr-test-typescript/documentation-robotics/model"
      paths: ["**/*.yaml"]
    skip: false
    expectedToFail: true

  - name: "Delete - remove element"
    description: "Verify delete command produces identical results"
    python:
      command: *python_cli
      args: ["--no-upgrade-check", "delete", "motivation.goal.test-goal"]
      cwd: "/tmp/dr-test-python"
      setup:
        - [
            "/bin/sh",
            "-c",
            "cd /tmp/dr-test-python && /Users/austinsand/workspace/documentation_robotics/.venv/bin/dr --no-upgrade-check add motivation goal --name 'Test Goal' && /Users/austinsand/workspace/documentation_robotics/.venv/bin/dr --no-upgrade-check add motivation goal --name 'Keep Goal'",
          ]
      timeout: 10000
    typescript:
      command: "bun"
      args:
        [
          "run",
          "/Users/austinsand/workspace/documentation_robotics/cli/src/cli.ts",
          "delete",
          "motivation.goal.test-goal",
        ]
      cwd: "/tmp/dr-test-typescript"
      setup:
        - [
            "/bin/sh",
            "-c",
            "cd /tmp/dr-test-typescript && bun run /Users/austinsand/workspace/documentation_robotics/cli/src/cli.ts add motivation goal 'Test Goal' && bun run /Users/austinsand/workspace/documentation_robotics/cli/src/cli.ts add motivation goal 'Keep Goal'",
          ]
      timeout: 10000
    comparison:
      type: "filesystem"
      pythonRoot: "/tmp/dr-test-python/documentation-robotics/model"
      typescriptRoot: "/tmp/dr-test-typescript/documentation-robotics/model"
      paths: ["**/*.yaml"]
    skip: false
    expectedToFail: true

  # ============================================================================
  # NOTE: Additional commands that could be tested:
  # - relationship add/list/delete (requires relationships schema)
  # - migrate (requires version changes)
