{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/10-navigation-layer.json",
  "title": "Navigation Layer Schema",
  "type": "object",
  "description": "ArchiMate Navigation Layer elements for business services, processes, actors, and objects",
  "properties": {
    "navigationGraphs": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/NavigationGraph"
      }
    },
    "routes": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Route"
      }
    },
    "routeMetas": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/RouteMeta"
      }
    },
    "navigationTransitions": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/NavigationTransition"
      }
    },
    "navigationGuards": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/NavigationGuard"
      }
    },
    "guardConditions": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/GuardCondition"
      }
    },
    "guardActions": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/GuardAction"
      }
    },
    "navigationFlows": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/NavigationFlow"
      }
    },
    "flowSteps": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/FlowStep"
      }
    },
    "contextVariables": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/ContextVariable"
      }
    },
    "dataMappings": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/DataMapping"
      }
    },
    "processTrackings": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/ProcessTracking"
      }
    },
    "flowAnalyticses": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/FlowAnalytics"
      }
    },
    "notificationActions": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/NotificationAction"
      }
    },
    "relationships": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Relationship"
      }
    }
  },
  "definitions": {
    "NavigationGraph": {
      "type": "object",
      "description": "Complete navigation structure for application",
      "required": [
        "id",
        "name",
        "version",
        "application"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "version": {
          "type": "string"
        },
        "application": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "routes": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 1,
          "description": "References to Route IDs"
        },
        "transitions": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 0,
          "description": "References to NavigationTransition IDs"
        },
        "guards": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 0,
          "description": "References to NavigationGuard IDs"
        }
      }
    },
    "Route": {
      "type": "object",
      "description": "Single route/destination in the application (channel-agnostic)",
      "required": [
        "id",
        "name",
        "type"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "experience",
            "redirect",
            "external"
          ]
        }
      }
    },
    "RouteMeta": {
      "type": "object",
      "description": "Route metadata",
      "required": [
        "id",
        "name",
        "roles",
        "permissions",
        "layout",
        "keepAlive",
        "transition"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "requiresAuth": {
          "type": "boolean"
        },
        "roles": {
          "type": "string"
        },
        "permissions": {
          "type": "string"
        },
        "layout": {
          "type": "string"
        },
        "breadcrumb": {
          "type": "string"
        },
        "keepAlive": {
          "type": "boolean"
        },
        "transition": {
          "type": "string"
        }
      }
    },
    "NavigationTransition": {
      "type": "object",
      "description": "Transition from one route to another",
      "required": [
        "id",
        "name",
        "from",
        "to",
        "trigger"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "from": {
          "type": "string"
        },
        "to": {
          "type": "string"
        },
        "trigger": {
          "type": "string",
          "enum": [
            "user-action",
            "submit",
            "success",
            "failure",
            "cancel",
            "automatic",
            "deeplink",
            "back",
            "timeout"
          ]
        },
        "description": {
          "type": "string"
        },
        "guards": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 0,
          "description": "References to NavigationGuard IDs"
        }
      }
    },
    "NavigationGuard": {
      "type": "object",
      "description": "Guard condition for route access",
      "required": [
        "id",
        "name",
        "type",
        "order"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "type": "string",
          "enum": [
            "authentication",
            "authorization",
            "validation",
            "data-loaded",
            "custom"
          ]
        },
        "description": {
          "type": "string"
        },
        "order": {
          "type": "integer"
        }
      }
    },
    "GuardCondition": {
      "type": "object",
      "description": "Condition expression for guard",
      "required": [
        "id",
        "name",
        "expression",
        "timeout"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "expression": {
          "type": "string"
        },
        "async": {
          "type": "boolean"
        },
        "timeout": {
          "type": "integer"
        }
      }
    },
    "GuardAction": {
      "type": "object",
      "description": "Action when guard denies access",
      "required": [
        "id",
        "name",
        "action",
        "target",
        "message",
        "preserveRoute"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "action": {
          "type": "string",
          "enum": [
            "redirect",
            "show-error",
            "navigate-back",
            "abort"
          ]
        },
        "target": {
          "type": "string"
        },
        "message": {
          "type": "string"
        },
        "preserveRoute": {
          "type": "boolean"
        }
      }
    },
    "NavigationFlow": {
      "type": "object",
      "description": "Sequence of routes that realizes a business process",
      "required": [
        "id",
        "name"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string"
        },
        "steps": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 1,
          "description": "References to FlowStep IDs"
        }
      }
    },
    "FlowStep": {
      "type": "object",
      "description": "One step in a navigation flow",
      "required": [
        "id",
        "name",
        "sequence",
        "route"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "sequence": {
          "type": "integer"
        },
        "route": {
          "type": "string"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string"
        },
        "required": {
          "type": "boolean"
        }
      }
    },
    "ContextVariable": {
      "type": "object",
      "description": "Shared variable across flow steps (Gap #1: Cross-experience state)",
      "required": [
        "id",
        "name",
        "schemaRef",
        "scope",
        "persistedIn"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "schemaRef": {
          "type": "string"
        },
        "scope": {
          "type": "string",
          "enum": [
            "flow",
            "session",
            "user"
          ]
        },
        "persistedIn": {
          "type": "string",
          "enum": [
            "memory",
            "session-storage",
            "local-storage",
            "server-session",
            "database"
          ]
        },
        "defaultValue": {
          "type": "string"
        }
      }
    },
    "DataMapping": {
      "type": "object",
      "description": "Maps data between flow context and experience (Gap #2: Data handoff)",
      "required": [
        "id",
        "name",
        "source",
        "target",
        "transform"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "source": {
          "type": "string"
        },
        "target": {
          "type": "string"
        },
        "transform": {
          "type": "string"
        },
        "required": {
          "type": "boolean"
        }
      }
    },
    "ProcessTracking": {
      "type": "object",
      "description": "Tracks business process instance across flow (Gap #3: Process correlation)",
      "required": [
        "id",
        "name",
        "processInstanceId",
        "timeoutMinutes",
        "stateCheckpoint"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "processInstanceId": {
          "type": "string"
        },
        "resumable": {
          "type": "boolean"
        },
        "timeoutMinutes": {
          "type": "integer"
        },
        "stateCheckpoint": {
          "type": "boolean"
        }
      }
    },
    "FlowAnalytics": {
      "type": "object",
      "description": "Analytics for funnel tracking (Gap #9: Funnel analytics)",
      "required": [
        "id",
        "name",
        "funnelMetrics",
        "conversionGoal"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "funnelMetrics": {
          "type": "string"
        },
        "conversionGoal": {
          "type": "string"
        },
        "dropoffAlerts": {
          "type": "string"
        }
      }
    },
    "NotificationAction": {
      "type": "object",
      "description": "Notification to send during flow step",
      "required": [
        "id",
        "name",
        "type",
        "template",
        "recipients"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "type": "string",
          "enum": [
            "email",
            "sms",
            "push",
            "webhook"
          ]
        },
        "template": {
          "type": "string"
        },
        "recipients": {
          "type": "string"
        }
      }
    },
    "Relationship": {
      "type": "object",
      "required": [
        "type",
        "source",
        "target"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "Composition",
            "Aggregation",
            "Assignment",
            "Realization",
            "Triggering",
            "Flow",
            "Association",
            "Access",
            "Serving"
          ]
        },
        "source": {
          "type": "string",
          "format": "uuid"
        },
        "target": {
          "type": "string",
          "format": "uuid"
        },
        "documentation": {
          "type": "string"
        }
      }
    }
  }
}
