{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/11-apm-observability-layer.json",
  "title": "Apm Observability Layer Schema",
  "type": "object",
  "description": "ArchiMate Apm Observability Layer elements for business services, processes, actors, and objects",
  "properties": {
    "spans": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Span"
      }
    },
    "spanEvents": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/SpanEvent"
      }
    },
    "spanLinks": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/SpanLink"
      }
    },
    "spanStatuses": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/SpanStatus"
      }
    },
    "logRecords": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/LogRecord"
      }
    },
    "resources": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Resource"
      }
    },
    "instrumentationScopes": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/InstrumentationScope"
      }
    },
    "attributes": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Attribute"
      }
    },
    "aPMConfigurations": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/APMConfiguration"
      }
    },
    "traceConfigurations": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/TraceConfiguration"
      }
    },
    "logConfigurations": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/LogConfiguration"
      }
    },
    "metricConfigurations": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/MetricConfiguration"
      }
    },
    "relationships": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/Relationship"
      }
    }
  },
  "definitions": {
    "Span": {
      "type": "object",
      "description": "Unit of work in distributed tracing",
      "required": [
        "id",
        "name",
        "traceId",
        "spanId",
        "traceState",
        "parentSpanId",
        "spanKind",
        "startTimeUnixNano",
        "endTimeUnixNano",
        "droppedAttributesCount",
        "droppedEventsCount",
        "droppedLinksCount"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "traceId": {
          "type": "string"
        },
        "spanId": {
          "type": "string"
        },
        "traceState": {
          "type": "string"
        },
        "parentSpanId": {
          "type": "string"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "spanKind": {
          "type": "string",
          "enum": [
            "INTERNAL",
            "SERVER",
            "CLIENT",
            "PRODUCER",
            "CONSUMER"
          ]
        },
        "startTimeUnixNano": {
          "type": "string"
        },
        "endTimeUnixNano": {
          "type": "string"
        },
        "droppedAttributesCount": {
          "type": "string"
        },
        "droppedEventsCount": {
          "type": "string"
        },
        "droppedLinksCount": {
          "type": "string"
        },
        "attributes": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 0,
          "description": "References to Attribute IDs"
        },
        "events": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 0,
          "description": "References to SpanEvent IDs"
        },
        "links": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 0,
          "description": "References to SpanLink IDs"
        }
      }
    },
    "SpanEvent": {
      "type": "object",
      "description": "Timestamped event during span execution",
      "required": [
        "id",
        "name",
        "timeUnixNano",
        "droppedAttributesCount"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "timeUnixNano": {
          "type": "string"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "droppedAttributesCount": {
          "type": "string"
        },
        "attributes": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 0,
          "description": "References to Attribute IDs"
        }
      }
    },
    "SpanLink": {
      "type": "object",
      "description": "Link to related span (different trace or parent)",
      "required": [
        "id",
        "name",
        "traceId",
        "spanId",
        "droppedAttributesCount"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "traceId": {
          "type": "string"
        },
        "spanId": {
          "type": "string"
        },
        "traceState": {
          "type": "string"
        },
        "droppedAttributesCount": {
          "type": "string"
        },
        "attributes": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 0,
          "description": "References to Attribute IDs"
        }
      }
    },
    "SpanStatus": {
      "type": "object",
      "description": "Outcome of span execution",
      "required": [
        "id",
        "name",
        "code"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "code": {
          "type": "string",
          "enum": [
            "UNSET",
            "OK",
            "ERROR"
          ]
        },
        "message": {
          "type": "string"
        }
      }
    },
    "LogRecord": {
      "type": "object",
      "description": "OpenTelemetry log entry",
      "required": [
        "id",
        "name",
        "timeUnixNano",
        "observedTimeUnixNano",
        "severityNumber",
        "body",
        "flags",
        "droppedAttributesCount"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "timeUnixNano": {
          "type": "string"
        },
        "observedTimeUnixNano": {
          "type": "string"
        },
        "severityNumber": {
          "type": "string",
          "enum": [
            "{'UNSPECIFIED': 0}",
            "{'TRACE': 1}",
            "{'TRACE2': 2}",
            "{'TRACE3': 3}",
            "{'TRACE4': 4}",
            "{'DEBUG': 5}",
            "{'DEBUG2': 6}",
            "{'DEBUG3': 7}",
            "{'DEBUG4': 8}",
            "{'INFO': 9}",
            "{'INFO2': 10}",
            "{'INFO3': 11}",
            "{'INFO4': 12}",
            "{'WARN': 13}",
            "{'WARN2': 14}",
            "{'WARN3': 15}",
            "{'WARN4': 16}",
            "{'ERROR': 17}",
            "{'ERROR2': 18}",
            "{'ERROR3': 19}",
            "{'ERROR4': 20}",
            "{'FATAL': 21}",
            "{'FATAL2': 22}",
            "{'FATAL3': 23}",
            "{'FATAL4': 24}"
          ]
        },
        "severityText": {
          "type": "string"
        },
        "body": {
          "type": "string"
        },
        "flags": {
          "type": "string"
        },
        "droppedAttributesCount": {
          "type": "string"
        },
        "attributes": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 0,
          "description": "References to Attribute IDs"
        }
      }
    },
    "Resource": {
      "type": "object",
      "description": "Immutable representation of entity producing telemetry",
      "required": [
        "id",
        "name",
        "droppedAttributesCount"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "schemaUrl": {
          "type": "string"
        },
        "droppedAttributesCount": {
          "type": "string"
        },
        "attributes": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 1,
          "description": "References to Attribute IDs"
        }
      }
    },
    "InstrumentationScope": {
      "type": "object",
      "description": "Logical unit of code that generates telemetry",
      "required": [
        "id",
        "name",
        "droppedAttributesCount"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "version": {
          "type": "string"
        },
        "schemaUrl": {
          "type": "string"
        },
        "droppedAttributesCount": {
          "type": "string"
        },
        "attributes": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uuid"
          },
          "minItems": 0,
          "description": "References to Attribute IDs"
        }
      }
    },
    "Attribute": {
      "type": "object",
      "description": "Key-value pair metadata",
      "required": [
        "id",
        "name",
        "key",
        "value"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "key": {
          "type": "string"
        },
        "value": {
          "type": "string"
        }
      }
    },
    "APMConfiguration": {
      "type": "object",
      "description": "Complete APM configuration for an application",
      "required": [
        "id",
        "name",
        "version",
        "application"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "version": {
          "type": "string"
        },
        "application": {
          "type": "string"
        }
      }
    },
    "TraceConfiguration": {
      "type": "object",
      "description": "Distributed tracing configuration",
      "required": [
        "id",
        "name",
        "serviceName"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "serviceName": {
          "type": "string"
        },
        "serviceVersion": {
          "type": "string"
        },
        "deploymentEnvironment": {
          "type": "string"
        }
      }
    },
    "LogConfiguration": {
      "type": "object",
      "description": "Logging configuration",
      "required": [
        "id",
        "name",
        "serviceName",
        "logLevel"
      ],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1
        },
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "serviceName": {
          "type": "string"
        },
        "logLevel": {
          "type": "string",
          "enum": [
            "TRACE",
            "DEBUG",
            "INFO",
            "WARN",
            "ERROR",
            "FATAL"
          ]
        }
      }
    },
    "MetricConfiguration": {
      "type": "object",
      "description": "Metrics configuration",
      "required": [
        "id",
        "name",
        "serviceName"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid"
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "serviceName": {
          "type": "string"
        },
        "exportIntervalMillis": {
          "type": "integer"
        }
      }
    },
    "Relationship": {
      "type": "object",
      "required": [
        "type",
        "source",
        "target"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "Composition",
            "Aggregation",
            "Assignment",
            "Realization",
            "Triggering",
            "Flow",
            "Association",
            "Access",
            "Serving"
          ]
        },
        "source": {
          "type": "string",
          "format": "uuid"
        },
        "target": {
          "type": "string",
          "format": "uuid"
        },
        "documentation": {
          "type": "string"
        }
      }
    }
  }
}
