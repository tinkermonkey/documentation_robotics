{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/10-navigation-layer.schema.json",
  "title": "Navigation Layer Schema",
  "description": "Defines application routing, navigation flows, transitions, and guards for channel-agnostic navigation across web, mobile, voice, and chat interfaces.",
  "type": "object",
  "properties": {
    "navigation-graphs": {
      "type": "array",
      "description": "Collection of NavigationGraph entities",
      "items": {
        "$ref": "#/definitions/NavigationGraph"
      }
    },
    "routes": {
      "type": "array",
      "description": "Collection of Route entities",
      "items": {
        "$ref": "#/definitions/Route"
      }
    },
    "route-metas": {
      "type": "array",
      "description": "Collection of RouteMeta entities",
      "items": {
        "$ref": "#/definitions/RouteMeta"
      }
    },
    "breadcrumb-configs": {
      "type": "array",
      "description": "Collection of BreadcrumbConfig entities",
      "items": {
        "$ref": "#/definitions/BreadcrumbConfig"
      }
    },
    "navigation-transitions": {
      "type": "array",
      "description": "Collection of NavigationTransition entities",
      "items": {
        "$ref": "#/definitions/NavigationTransition"
      }
    },
    "navigation-guards": {
      "type": "array",
      "description": "Collection of NavigationGuard entities",
      "items": {
        "$ref": "#/definitions/NavigationGuard"
      }
    },
    "guard-conditions": {
      "type": "array",
      "description": "Collection of GuardCondition entities",
      "items": {
        "$ref": "#/definitions/GuardCondition"
      }
    },
    "guard-actions": {
      "type": "array",
      "description": "Collection of GuardAction entities",
      "items": {
        "$ref": "#/definitions/GuardAction"
      }
    },
    "navigation-flows": {
      "type": "array",
      "description": "Collection of NavigationFlow entities",
      "items": {
        "$ref": "#/definitions/NavigationFlow"
      }
    },
    "flow-steps": {
      "type": "array",
      "description": "Collection of FlowStep entities",
      "items": {
        "$ref": "#/definitions/FlowStep"
      }
    },
    "context-variables": {
      "type": "array",
      "description": "Collection of ContextVariable entities",
      "items": {
        "$ref": "#/definitions/ContextVariable"
      }
    },
    "data-mappings": {
      "type": "array",
      "description": "Collection of DataMapping entities",
      "items": {
        "$ref": "#/definitions/DataMapping"
      }
    },
    "process-trackings": {
      "type": "array",
      "description": "Collection of ProcessTracking entities",
      "items": {
        "$ref": "#/definitions/ProcessTracking"
      }
    },
    "flow-analyticses": {
      "type": "array",
      "description": "Collection of FlowAnalytics entities",
      "items": {
        "$ref": "#/definitions/FlowAnalytics"
      }
    },
    "notification-actions": {
      "type": "array",
      "description": "Collection of NotificationAction entities",
      "items": {
        "$ref": "#/definitions/NotificationAction"
      }
    }
  },
  "definitions": {
    "NavigationGraph": {
      "type": "object",
      "description": "Complete navigation structure for application",
      "required": [
        "id",
        "name",
        "version",
        "application"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "version": {
          "type": "string",
          "minLength": 1
        },
        "application": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "minLength": 1
        },
        "routes": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        },
        "transitions": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        },
        "guards": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "Route": {
      "type": "object",
      "description": "Single route/destination in the application (channel-agnostic)",
      "required": [
        "id",
        "name",
        "type"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "title": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "$ref": "#/definitions/enum"
        }
      },
      "definitions": {
        "RouteType": {
          "type": "string",
          "enum": [
            "experience",
            "redirect",
            "external"
          ]
        }
      }
    },
    "RouteMeta": {
      "type": "object",
      "description": "Route metadata",
      "required": [
        "id",
        "name",
        "roles",
        "permissions",
        "layout",
        "keepAlive",
        "transition"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "requiresAuth": {
          "type": "boolean"
        },
        "roles": {
          "type": "string",
          "minLength": 1
        },
        "permissions": {
          "type": "string",
          "minLength": 1
        },
        "layout": {
          "type": "string",
          "minLength": 1
        },
        "breadcrumb": {
          "type": "string",
          "minLength": 1
        },
        "keepAlive": {
          "type": "boolean"
        },
        "transition": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "BreadcrumbConfig": {
      "type": "object",
      "description": "Configuration for breadcrumb navigation display, specifying path generation rules, separator styles, truncation behavior, and home link settings. Provides users with location context and navigation history.",
      "required": [
        "id",
        "name",
        "label"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "label": {
          "type": "string",
          "minLength": 1
        },
        "labelTemplate": {
          "type": "string",
          "minLength": 1
        },
        "showHome": {
          "type": "boolean"
        },
        "homeLabel": {
          "type": "string",
          "minLength": 1
        },
        "homeRoute": {
          "type": "string",
          "minLength": 1
        }
      },
      "definitions": {
        "TruncationType": {
          "type": "string",
          "enum": [
            "none",
            "middle",
            "start",
            "end"
          ]
        },
        "BreadcrumbMode": {
          "type": "string",
          "enum": [
            "static",
            "dynamic",
            "hybrid"
          ]
        }
      }
    },
    "NavigationTransition": {
      "type": "object",
      "description": "Transition from one route to another",
      "required": [
        "id",
        "name",
        "from",
        "to",
        "trigger"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "from": {
          "type": "string",
          "minLength": 1
        },
        "to": {
          "type": "string",
          "minLength": 1
        },
        "trigger": {
          "$ref": "#/definitions/enum"
        },
        "description": {
          "type": "string",
          "minLength": 1
        },
        "guards": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        }
      },
      "definitions": {
        "NavigationTrigger": {
          "type": "string",
          "enum": [
            "user-action",
            "submit",
            "success",
            "failure",
            "cancel",
            "automatic",
            "deeplink",
            "back",
            "timeout"
          ]
        }
      }
    },
    "NavigationGuard": {
      "type": "object",
      "description": "Guard condition for route access",
      "required": [
        "id",
        "name",
        "type",
        "order"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "$ref": "#/definitions/enum"
        },
        "description": {
          "type": "string",
          "minLength": 1
        },
        "order": {
          "type": "integer"
        }
      },
      "definitions": {
        "GuardType": {
          "type": "string",
          "enum": [
            "authentication",
            "authorization",
            "validation",
            "data-loaded",
            "custom"
          ]
        },
        "HttpMethod": {
          "type": "string",
          "enum": [
            "GET",
            "POST",
            "PUT",
            "DELETE",
            "PATCH",
            "HEAD",
            "OPTIONS"
          ]
        }
      }
    },
    "GuardCondition": {
      "type": "object",
      "description": "Condition expression for guard",
      "required": [
        "id",
        "name",
        "expression",
        "timeout"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "expression": {
          "type": "string",
          "minLength": 1
        },
        "async": {
          "type": "boolean"
        },
        "timeout": {
          "type": "integer"
        }
      }
    },
    "GuardAction": {
      "type": "object",
      "description": "Action when guard denies access",
      "required": [
        "id",
        "name",
        "action",
        "target",
        "message",
        "preserveRoute"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "action": {
          "$ref": "#/definitions/enum"
        },
        "target": {
          "type": "string",
          "minLength": 1
        },
        "message": {
          "type": "string",
          "minLength": 1
        },
        "preserveRoute": {
          "type": "boolean"
        }
      },
      "definitions": {
        "GuardActionType": {
          "type": "string",
          "enum": [
            "redirect",
            "show-error",
            "navigate-back",
            "abort"
          ]
        }
      }
    },
    "NavigationFlow": {
      "type": "object",
      "description": "Sequence of routes that realizes a business process",
      "required": [
        "id",
        "name"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "minLength": 1
        },
        "steps": {
          "type": "array",
          "description": "Contains relationship",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "FlowStep": {
      "type": "object",
      "description": "One step in a navigation flow",
      "required": [
        "id",
        "sequence",
        "route",
        "name"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "sequence": {
          "type": "integer"
        },
        "route": {
          "type": "string",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "description": {
          "type": "string",
          "minLength": 1
        },
        "required": {
          "type": "boolean"
        }
      },
      "definitions": {
        "WaitType": {
          "type": "string",
          "enum": [
            "user-action",
            "approval",
            "external-event",
            "timeout"
          ]
        }
      }
    },
    "ContextVariable": {
      "type": "object",
      "description": "Shared variable across flow steps (Gap #1: Cross-experience state)",
      "required": [
        "id",
        "name",
        "schemaRef",
        "scope",
        "persistedIn"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "schemaRef": {
          "type": "string",
          "minLength": 1
        },
        "scope": {
          "$ref": "#/definitions/enum"
        },
        "persistedIn": {
          "$ref": "#/definitions/enum"
        },
        "defaultValue": {
          "type": "string",
          "minLength": 1
        }
      },
      "definitions": {
        "ContextScope": {
          "type": "string",
          "enum": [
            "flow",
            "session",
            "user"
          ]
        },
        "StorageType": {
          "type": "string",
          "enum": [
            "memory",
            "session-storage",
            "local-storage",
            "server-session",
            "database"
          ]
        }
      }
    },
    "DataMapping": {
      "type": "object",
      "description": "Maps data between flow context and experience (Gap #2: Data handoff)",
      "required": [
        "id",
        "name",
        "source",
        "target",
        "transform"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "source": {
          "type": "string",
          "minLength": 1
        },
        "target": {
          "type": "string",
          "minLength": 1
        },
        "transform": {
          "type": "string",
          "minLength": 1
        },
        "required": {
          "type": "boolean"
        }
      }
    },
    "ProcessTracking": {
      "type": "object",
      "description": "Tracks business process instance across flow (Gap #3: Process correlation)",
      "required": [
        "id",
        "name",
        "processInstanceId",
        "timeoutMinutes",
        "stateCheckpoint"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "processInstanceId": {
          "type": "string",
          "minLength": 1
        },
        "resumable": {
          "type": "boolean"
        },
        "timeoutMinutes": {
          "type": "integer"
        },
        "stateCheckpoint": {
          "type": "boolean"
        }
      }
    },
    "FlowAnalytics": {
      "type": "object",
      "description": "Analytics for funnel tracking (Gap #9: Funnel analytics)",
      "required": [
        "id",
        "name",
        "funnelMetrics",
        "conversionGoal"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "funnelMetrics": {
          "type": "string",
          "minLength": 1
        },
        "conversionGoal": {
          "type": "string",
          "minLength": 1
        },
        "dropoffAlerts": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "NotificationAction": {
      "type": "object",
      "description": "Notification to send during flow step",
      "required": [
        "id",
        "name",
        "type",
        "template",
        "recipients"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "minLength": 1
        },
        "type": {
          "$ref": "#/definitions/enum"
        },
        "template": {
          "type": "string",
          "minLength": 1
        },
        "recipients": {
          "type": "string",
          "minLength": 1
        }
      },
      "definitions": {
        "NotificationType": {
          "type": "string",
          "enum": [
            "email",
            "sms",
            "push",
            "webhook"
          ]
        }
      }
    }
  },
  "$defs": {
    "relationships": {
      "$ref": "common/relationships.schema.json#/definitions"
    },
    "predicates": {
      "$ref": "common/predicates.schema.json#/definitions"
    }
  }
}
