{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "StoredLogic",
  "description": "Stored computation logic that executes within the data store engine. Paradigm-neutral: covers SQL functions and procedures, MongoDB aggregation pipelines, Redis Lua scripts, Cassandra UDFs, Neo4j stored procedures, Elasticsearch ingest pipelines, time-series continuous queries, and DynamoDB Lambda triggers.",
  "allOf": [
    {
      "$ref": "../../base/spec-node.schema.json"
    }
  ],
  "properties": {
    "spec_node_id": {
      "const": "data-store.storedlogic"
    },
    "layer_id": {
      "const": "data-store"
    },
    "type": {
      "const": "storedlogic"
    },
    "attributes": {
      "type": "object",
      "properties": {
        "logicType": {
          "type": "string",
          "enum": [
            "FUNCTION",
            "PROCEDURE",
            "PACKAGE",
            "AGGREGATION_PIPELINE",
            "MAP_REDUCE",
            "LUA_SCRIPT",
            "LAMBDA",
            "UDF",
            "UDA",
            "CONTINUOUS_QUERY",
            "FLUX_TASK",
            "STORED_PROCEDURE",
            "CYPHER_FUNCTION",
            "INGEST_PIPELINE",
            "PAINLESS_SCRIPT",
            "CUSTOM"
          ],
          "description": "Type of stored computation. FUNCTION/PROCEDURE/PACKAGE: SQL-standard. AGGREGATION_PIPELINE/MAP_REDUCE: document store (MongoDB). LUA_SCRIPT: key-value (Redis). LAMBDA: serverless trigger (DynamoDB Streams). UDF/UDA: user-defined function/aggregate (Cassandra). CONTINUOUS_QUERY/FLUX_TASK: time-series scheduled computation. STORED_PROCEDURE/CYPHER_FUNCTION: graph database. INGEST_PIPELINE/PAINLESS_SCRIPT: search engine. CUSTOM: engine-specific type not listed."
        },
        "language": {
          "type": "string",
          "enum": [
            "SQL",
            "PLPGSQL",
            "PLSQL",
            "TSQL",
            "JAVASCRIPT",
            "PYTHON",
            "LUA",
            "JAVA",
            "C",
            "CYPHER",
            "GREMLIN",
            "SPARQL",
            "FLUX",
            "INFLUXQL",
            "PAINLESS",
            "MVEL",
            "MQL",
            "EXTERNAL",
            "CUSTOM"
          ],
          "description": "Implementation language. SQL/PLPGSQL/PLSQL/TSQL: relational database languages. JAVASCRIPT/PYTHON/LUA/JAVA/C: general-purpose embedded languages. CYPHER/GREMLIN/SPARQL: graph query languages. FLUX/INFLUXQL: time-series query languages. PAINLESS/MVEL: search engine scripting. MQL: MongoDB Query Language. EXTERNAL: logic implemented outside the database. CUSTOM: language not listed."
        },
        "returnType": {
          "type": "string",
          "description": "Return type of the computation. For functions, the return data type. For pipelines, the output document shape. For void procedures, 'VOID'."
        },
        "deterministic": {
          "type": "boolean",
          "description": "Whether the logic always returns the same output for the same input. Generalizes SQL volatility (IMMUTABLE = true, VOLATILE = false) across paradigms. Deterministic logic is a candidate for result caching."
        },
        "sideEffects": {
          "type": "boolean",
          "description": "Whether the logic can modify data. Functions without side effects are safe for parallel execution and caching. Maps to SQL CONTAINS SQL / MODIFIES SQL DATA distinction."
        },
        "security": {
          "type": "string",
          "enum": ["DEFINER", "INVOKER"],
          "description": "Security context for execution. DEFINER: runs with privileges of the creator (SQL SECURITY DEFINER). INVOKER: runs with privileges of the caller (SQL SECURITY INVOKER)."
        },
        "x-source-reference": {
          "type": "string",
          "description": "Source code reference using OpenAPI x- extension pattern."
        }
      },
      "required": ["logicType", "language"],
      "additionalProperties": false
    }
  }
}
