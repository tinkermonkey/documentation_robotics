{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RateLimit",
  "description": "Defines throttling constraints for API or service access, specifying maximum request counts, time windows, and actions to take when limits are exceeded. Protects resources from abuse and ensures fair usage across consumers.",
  "allOf": [
    {
      "$ref": "../../base/spec-node.schema.json"
    }
  ],
  "properties": {
    "spec_node_id": {
      "const": "api.ratelimit"
    },
    "layer_id": {
      "const": "api"
    },
    "type": {
      "const": "ratelimit"
    },
    "attributes": {
      "type": "object",
      "properties": {
        "requests": {
          "type": "integer",
          "description": "Maximum number of requests permitted within the specified time window."
        },
        "window": {
          "type": "string",
          "description": "Duration of the rate limit window (e.g., '1m', '1h', '24h'). Requests are counted and reset per window."
        },
        "scope": {
          "type": "string",
          "enum": ["global", "per-user", "per-ip", "per-api-key"],
          "description": "Scope at which the rate limit is applied."
        },
        "action": {
          "type": "string",
          "enum": ["block", "throttle", "queue", "log", "challenge"],
          "description": "Action taken when the rate limit is exceeded, per NIST SC-5 (Denial-of-Service Protection)."
        },
        "keyBy": {
          "type": "string",
          "description": "Attribute used to identify and group requests for rate limit counting (e.g., 'user.id', 'request.ip', 'api-key')."
        },
        "source": {
          "type": "object",
          "description": "Source code reference"
        }
      },
      "required": ["requests", "window", "keyBy"],
      "additionalProperties": false
    }
  }
}
