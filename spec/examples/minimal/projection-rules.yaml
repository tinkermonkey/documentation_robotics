# Projection Rules for Minimal Example
#
# Demonstrates how elements can be automatically projected across layers
# using templates, conditions, and property transformations.

projections:
  # Project goals to business services
  - name: goals-to-business-services
    from: motivation.goal
    to: business.service
    conditions:
      - field: properties.criticality
        operator: equals
        value: critical
    rules:
      - create_type: service
        name_template: "{source.name} Service"
        properties:
          description:
            target: description
            transform: template
            transform_value: "Business service supporting: {value}"
          criticality:
            target: properties.criticality
          supports_goal:
            target: properties.supports_goals
            transform: template
            transform_value: "motivation.goal.{value}"
        create_bidirectional: true

  # Project business services to application services
  - name: business-to-application
    from: business.service
    to: application.service
    rules:
      - create_type: service
        name_template: "{source.name_pascal}Service"
        properties:
          name:
            target: name
            transform: pascal
          description:
            target: description
          runtime:
            target: properties.runtime
            default: "java-spring-boot"
          realizes:
            target: properties.realizes
            transform: template
            transform_value: "{value}"
        create_bidirectional: true

  # Project application services to API operations
  - name: application-to-api
    from: application.service
    to: api.operation
    conditions:
      - field: properties.runtime
        operator: exists
    rules:
      - create_type: operation
        name_template: "Get {source.name}"
        properties:
          method:
            target: properties.method
            default: "GET"
          path:
            target: properties.path
            transform: template
            transform_value: "/api/{value}"
            source: name_kebab
          service:
            target: properties.service
          auth_required:
            target: properties.security.authentication_required
            default: true
        create_bidirectional: true

  # Project API operations to data models
  - name: api-to-data-model
    from: api.operation
    to: data_model.schema
    conditions:
      - field: properties.method
        operator: equals
        value: "GET"
    rules:
      - create_type: schema
        name_template: "{source.name}Response"
        properties:
          schema_type:
            target: properties.schema_type
            default: "json-schema"
          format:
            target: properties.format
            default: "application/json"
        create_bidirectional: true

  # Project high-criticality elements to metrics
  - name: critical-services-to-metrics
    from: application.service
    to: apm.metric
    conditions:
      - field: properties.criticality
        operator: equals
        value: critical
    rules:
      - create_type: metric
        name_template: "{source.name_kebab}-availability"
        properties:
          metric_name:
            target: properties.metric_name
            transform: snake
            source: name
          metric_type:
            target: properties.metric_type
            default: "gauge"
          unit:
            target: properties.unit
            default: "percent"
          target_value:
            target: properties.target_value
            default: 99.9
          monitors:
            target: properties.monitors
        create_bidirectional: true

# Transformation examples:
# - uppercase: Convert to UPPERCASE
# - lowercase: Convert to lowercase
# - kebab: Convert to kebab-case
# - snake: Convert to snake_case
# - pascal: Convert to PascalCase
# - prefix: Add prefix to value
# - suffix: Add suffix to value
# - template: Use template string with {value} placeholder

# Operator examples:
# - equals: Field equals value
# - not_equals: Field not equals value
# - contains: Field contains substring
# - matches: Field matches regex pattern
# - exists: Field exists (not None)
# - gt: Field greater than value
# - lt: Field less than value
