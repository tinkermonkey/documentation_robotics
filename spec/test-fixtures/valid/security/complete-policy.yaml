# Valid security layer fixture - Complete security policy with roles and resources
# Tests: Schema validation, security integration, cross-layer enforcement

version: "0.1.0"
security-model:
  authentication:
    methods:
      - oauth2
      - api-key
    mfa-required: true
    session-timeout: 3600

  policies:
    - id: security.policy.authenticated-access
      name: Authenticated Access Policy
      description: Requires authentication for all protected resources
      type: access-control
      scope: global
      rules:
        - condition: user.isAuthenticated()
          action: allow
        - condition: "!user.isAuthenticated()"
          action: deny
          redirect: /login
      enforcement-points:
        - application.service.ticket-management
        - application.service.user-profile
        - api.operation.create-ticket
        - ux.screen.dashboard

    - id: security.policy.admin-only
      name: Admin Only Policy
      description: Restricts access to admin role
      type: authorization
      scope: admin-functions
      rules:
        - condition: user.hasRole('admin')
          action: allow
        - condition: "!user.hasRole('admin')"
          action: deny
          message: "Insufficient permissions"
      enforcement-points:
        - application.service.user-management
        - api.operation.delete-user
        - ux.screen.admin-panel

  roles:
    - id: security.role.admin
      name: Administrator
      description: Full system access
      permissions:
        - "users:*"
        - "tickets:*"
        - "settings:*"
      inherits: []

    - id: security.role.support-agent
      name: Support Agent
      description: Customer support agent
      permissions:
        - "tickets:read"
        - "tickets:update"
        - "tickets:comment"
        - "customers:read"
      inherits: []

    - id: security.role.customer
      name: Customer
      description: Regular customer user
      permissions:
        - "tickets:read:own"
        - "tickets:create"
        - "profile:read:own"
        - "profile:update:own"
      inherits: []

  resources:
    - id: security.resource.ticket-api
      name: Ticket API
      description: Ticket management API endpoints
      type: api
      archimateRef: application.service.ticket-management
      protected-operations:
        - api.operation.create-ticket
        - api.operation.update-ticket
        - api.operation.delete-ticket
      required-roles:
        - security.role.customer
        - security.role.support-agent
        - security.role.admin

    - id: security.resource.user-data
      name: User Personal Data
      description: User personally identifiable information
      type: data
      classification: pii
      dataModelRefs:
        - data_model.schema.user
      encryption-required: true
      retention-policy: "7 years"
      required-roles:
        - security.role.admin
