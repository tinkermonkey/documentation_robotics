# Valid APM layer fixture - Complete observability with traces, metrics, and data quality
# Tests: Schema validation, goal traceability, data quality metrics

version: "0.1.0"
application: "ticket-management"
description: "Observability specification for ticket management system"

traces:
  - id: apm.trace.ticket-operations
    name: "Ticket Operations Trace"
    description: "Traces all ticket-related operations"
    type: distributed
    span-kind: server
    instruments:
      - application.service.ticket-management
    attributes:
      service.name: "ticket-management"
      service.version: "2.1.0"
    propagation: w3c-trace-context
    sampling-rate: 1.0

metrics:
  - id: apm.metric.ticket-creation-time
    name: "Ticket Creation Time"
    description: "Time to create a new ticket"
    type: histogram
    unit: milliseconds
    instruments:
      - application.service.ticket-management
    dimensions:
      - "ticket.type"
      - "ticket.priority"
    aggregation: percentile
    thresholds:
      p50: 200
      p95: 500
      p99: 1000
    measures-goal: motivation.goal.improve-customer-satisfaction
    alert-rules:
      - condition: "p95 > 500"
        severity: warning
      - condition: "p99 > 1000"
        severity: critical

  - id: apm.metric.ticket-resolution-time
    name: "Ticket Resolution Time"
    description: "Time from ticket creation to resolution"
    type: gauge
    unit: hours
    instruments:
      - application.service.ticket-management
    dimensions:
      - "ticket.priority"
      - "agent.id"
    measures-goal: motivation.goal.improve-customer-satisfaction
    thresholds:
      high-priority: 4
      medium-priority: 24
      low-priority: 72

  - id: apm.metric.nps-score
    name: "Net Promoter Score"
    description: "Customer satisfaction metric"
    type: gauge
    unit: score
    measures-goal: motivation.goal.improve-customer-satisfaction
    collection-frequency: daily
    target: 8.5
    current-value: 7.8

data-quality-metrics:
  - id: apm.data-quality.user-data-completeness
    name: "User Data Completeness"
    description: "Percentage of user records with complete data"
    dimension: completeness
    data-entity-ref: data_model.schema.user
    measurement-method: automated
    collection-frequency: hourly
    threshold:
      warning: 95
      critical: 90
    current-value: 97.5

  - id: apm.data-quality.ticket-data-accuracy
    name: "Ticket Data Accuracy"
    description: "Accuracy of ticket categorization"
    dimension: accuracy
    data-entity-ref: data_model.schema.ticket
    measurement-method: sample
    collection-frequency: daily
    threshold:
      warning: 95
      critical: 90
    validation-rules:
      - "category matches product"
      - "priority aligns with SLA"
    current-value: 96.2

  - id: apm.data-quality.ticket-timeliness
    name: "Ticket Data Timeliness"
    description: "How quickly ticket data is updated"
    dimension: timeliness
    data-entity-ref: data_model.schema.ticket
    measurement-method: automated
    collection-frequency: hourly
    threshold:
      warning: 60
      critical: 300
    unit: seconds
    current-value: 15

logs:
  - id: apm.log.application-logs
    name: "Application Logs"
    description: "Structured application logs"
    format: json
    level: info
    instruments:
      - application.service.ticket-management
      - application.service.notification
    retention-days: 30
    attributes:
      - timestamp
      - level
      - service
      - trace-id
      - span-id
      - message
      - user-id
      - tenant-id
