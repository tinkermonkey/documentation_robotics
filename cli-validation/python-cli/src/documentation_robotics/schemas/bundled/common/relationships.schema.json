{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/schemas/common/relationships.schema.json",
  "title": "Common Relationship Definitions",
  "description": "Reusable JSON Schema definitions for cross-layer relationships in Documentation Robotics",
  "version": "1.0.0",

  "definitions": {
    "RelationshipMetadata": {
      "type": "object",
      "description": "Metadata about a relationship between elements",
      "properties": {
        "predicate": {
          "type": "string",
          "description": "Semantic predicate describing the relationship (e.g., 'supports', 'realizes', 'implements')"
        },
        "inversePredicate": {
          "type": "string",
          "description": "Inverse predicate for bidirectional navigation (e.g., 'supported-by', 'realized-by', 'implemented-by')"
        },
        "targetType": {
          "type": "string",
          "description": "Target element type name (e.g., 'Goal', 'BusinessService', 'ApplicationComponent')"
        },
        "targetLayer": {
          "type": "string",
          "pattern": "^\\d{2}-[a-z-]+$",
          "description": "Target layer ID (e.g., '01-motivation', '02-business', '04-application')"
        },
        "strength": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"],
          "description": "Relationship strength indicating importance"
        },
        "category": {
          "type": "string",
          "description": "Relationship category (e.g., 'motivation', 'business', 'security', 'structural')"
        },
        "bidirectional": {
          "type": "boolean",
          "description": "Whether the relationship can be navigated in both directions",
          "default": false
        }
      }
    },

    "UuidReference": {
      "type": "string",
      "format": "uuid",
      "description": "UUID reference to another element",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$"
    },

    "UuidReferenceArray": {
      "type": "array",
      "description": "Array of UUID references",
      "items": {
        "$ref": "#/definitions/UuidReference"
      },
      "uniqueItems": true
    },

    "MotivationProperties": {
      "type": "object",
      "description": "Motivation layer relationship properties",
      "properties": {
        "supports-goals": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Goal IDs this element supports",
              "x-relationship": {
                "predicate": "supports",
                "inversePredicate": "supported-by",
                "targetType": "Goal",
                "targetLayer": "01-motivation",
                "strength": "high",
                "category": "motivation",
                "bidirectional": true
              }
            }
          ]
        },
        "realizes-outcomes": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Outcome IDs this element realizes",
              "x-relationship": {
                "predicate": "realizes",
                "inversePredicate": "realized-by",
                "targetType": "Outcome",
                "targetLayer": "01-motivation",
                "strength": "high",
                "category": "motivation",
                "bidirectional": true
              }
            }
          ]
        },
        "fulfills-requirements": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Requirement IDs this element fulfills",
              "x-relationship": {
                "predicate": "fulfills",
                "inversePredicate": "fulfilled-by",
                "targetType": "Requirement",
                "targetLayer": "01-motivation",
                "strength": "high",
                "category": "motivation",
                "bidirectional": true
              }
            }
          ]
        },
        "delivers-value": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Value IDs this element delivers",
              "x-relationship": {
                "predicate": "delivers",
                "inversePredicate": "delivered-by",
                "targetType": "Value",
                "targetLayer": "01-motivation",
                "strength": "high",
                "category": "motivation",
                "bidirectional": true
              }
            }
          ]
        },
        "constrained-by": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Constraint IDs that constrain this element",
              "x-relationship": {
                "predicate": "constrained-by",
                "inversePredicate": "constrains",
                "targetType": "Constraint",
                "targetLayer": "01-motivation",
                "strength": "medium",
                "category": "motivation",
                "bidirectional": true
              }
            }
          ]
        },
        "governed-by": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Principle IDs that govern this element",
              "x-relationship": {
                "predicate": "governed-by",
                "inversePredicate": "governs",
                "targetType": "Principle",
                "targetLayer": "01-motivation",
                "strength": "high",
                "category": "motivation",
                "bidirectional": true
              }
            }
          ]
        }
      }
    },

    "BusinessProperties": {
      "type": "object",
      "description": "Business layer relationship properties",
      "properties": {
        "owned-by-actor": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Business Actor IDs that own this element",
              "x-relationship": {
                "predicate": "owned-by",
                "inversePredicate": "owns",
                "targetType": "BusinessActor",
                "targetLayer": "02-business",
                "strength": "medium",
                "category": "business",
                "bidirectional": true
              }
            }
          ]
        },
        "performed-by-role": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Business Role IDs that perform this element",
              "x-relationship": {
                "predicate": "performed-by",
                "inversePredicate": "performs",
                "targetType": "BusinessRole",
                "targetLayer": "02-business",
                "strength": "medium",
                "category": "business",
                "bidirectional": true
              }
            }
          ]
        },
        "provides-service": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Business Service IDs provided by this element",
              "x-relationship": {
                "predicate": "provides",
                "inversePredicate": "provided-by",
                "targetType": "BusinessService",
                "targetLayer": "02-business",
                "strength": "high",
                "category": "business",
                "bidirectional": true
              }
            }
          ]
        },
        "consumes-service": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Business Service IDs consumed by this element",
              "x-relationship": {
                "predicate": "consumes",
                "inversePredicate": "consumed-by",
                "targetType": "BusinessService",
                "targetLayer": "02-business",
                "strength": "medium",
                "category": "business",
                "bidirectional": true
              }
            }
          ]
        }
      }
    },

    "SecurityProperties": {
      "type": "object",
      "description": "Security layer relationship properties",
      "properties": {
        "requires-permission": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Permission IDs required by this element",
              "x-relationship": {
                "predicate": "requires",
                "inversePredicate": "required-by",
                "targetType": "Permission",
                "targetLayer": "03-security",
                "strength": "critical",
                "category": "security",
                "bidirectional": true
              }
            }
          ]
        },
        "assigned-role": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Security Role IDs assigned to this element",
              "x-relationship": {
                "predicate": "assigned",
                "inversePredicate": "assigned-to",
                "targetType": "SecurityRole",
                "targetLayer": "03-security",
                "strength": "critical",
                "category": "security",
                "bidirectional": true
              }
            }
          ]
        },
        "protected-by-control": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Security Control IDs protecting this element",
              "x-relationship": {
                "predicate": "protected-by",
                "inversePredicate": "protects",
                "targetType": "SecurityControl",
                "targetLayer": "03-security",
                "strength": "high",
                "category": "security",
                "bidirectional": true
              }
            }
          ]
        },
        "mitigates-threat": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Threat IDs mitigated by this element",
              "x-relationship": {
                "predicate": "mitigates",
                "inversePredicate": "mitigated-by",
                "targetType": "Threat",
                "targetLayer": "03-security",
                "strength": "high",
                "category": "security",
                "bidirectional": true
              }
            }
          ]
        },
        "accesses-resource": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Security Resource IDs accessed by this element",
              "x-relationship": {
                "predicate": "accesses",
                "inversePredicate": "accessed-by",
                "targetType": "SecurityResource",
                "targetLayer": "03-security",
                "strength": "critical",
                "category": "security",
                "bidirectional": true
              }
            }
          ]
        }
      }
    },

    "ApplicationProperties": {
      "type": "object",
      "description": "Application layer relationship properties",
      "properties": {
        "realizes-service": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Business Service IDs realized by this application element",
              "x-relationship": {
                "predicate": "realizes",
                "inversePredicate": "realized-by",
                "targetType": "BusinessService",
                "targetLayer": "02-business",
                "strength": "high",
                "category": "application",
                "bidirectional": true
              }
            }
          ]
        },
        "provides-app-service": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Application Service IDs provided by this element",
              "x-relationship": {
                "predicate": "provides",
                "inversePredicate": "provided-by",
                "targetType": "ApplicationService",
                "targetLayer": "04-application",
                "strength": "high",
                "category": "application",
                "bidirectional": true
              }
            }
          ]
        },
        "uses-component": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Application Component IDs used by this element",
              "x-relationship": {
                "predicate": "uses",
                "inversePredicate": "used-by",
                "targetType": "ApplicationComponent",
                "targetLayer": "04-application",
                "strength": "medium",
                "category": "application",
                "bidirectional": true
              }
            }
          ]
        }
      }
    },

    "TechnologyProperties": {
      "type": "object",
      "description": "Technology layer relationship properties",
      "properties": {
        "deployed-on": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Infrastructure Node IDs this element is deployed on",
              "x-relationship": {
                "predicate": "deployed-on",
                "inversePredicate": "hosts",
                "targetType": "InfrastructureNode",
                "targetLayer": "05-technology",
                "strength": "high",
                "category": "technology",
                "bidirectional": true
              }
            }
          ]
        },
        "runs-on-platform": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Platform IDs this element runs on",
              "x-relationship": {
                "predicate": "runs-on",
                "inversePredicate": "supports-runtime",
                "targetType": "Platform",
                "targetLayer": "05-technology",
                "strength": "medium",
                "category": "technology",
                "bidirectional": true
              }
            }
          ]
        }
      }
    },

    "ApiProperties": {
      "type": "object",
      "description": "API layer relationship properties",
      "properties": {
        "exposes-operation": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "API Operation IDs exposed by this element",
              "x-relationship": {
                "predicate": "exposes",
                "inversePredicate": "exposed-by",
                "targetType": "ApiOperation",
                "targetLayer": "06-api",
                "strength": "high",
                "category": "api",
                "bidirectional": true
              }
            }
          ]
        },
        "implements-endpoint": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "API Endpoint IDs implemented by this element",
              "x-relationship": {
                "predicate": "implements",
                "inversePredicate": "implemented-by",
                "targetType": "ApiEndpoint",
                "targetLayer": "06-api",
                "strength": "high",
                "category": "api",
                "bidirectional": true
              }
            }
          ]
        }
      }
    },

    "DataProperties": {
      "type": "object",
      "description": "Data model relationship properties",
      "properties": {
        "uses-schema": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Schema IDs used by this element",
              "x-relationship": {
                "predicate": "uses",
                "inversePredicate": "used-by",
                "targetType": "Schema",
                "targetLayer": "07-data-model",
                "strength": "high",
                "category": "data",
                "bidirectional": true
              }
            }
          ]
        },
        "references-entity": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Entity IDs referenced by this element",
              "x-relationship": {
                "predicate": "references",
                "inversePredicate": "referenced-by",
                "targetType": "Entity",
                "targetLayer": "07-data-model",
                "strength": "medium",
                "category": "data",
                "bidirectional": true
              }
            }
          ]
        }
      }
    },

    "DatastoreProperties": {
      "type": "object",
      "description": "Datastore layer relationship properties",
      "properties": {
        "persists-to-database": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Database IDs this element persists to",
              "x-relationship": {
                "predicate": "persists-to",
                "inversePredicate": "stores",
                "targetType": "Database",
                "targetLayer": "08-datastore",
                "strength": "high",
                "category": "datastore",
                "bidirectional": true
              }
            }
          ]
        },
        "maps-to-table": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Table IDs this element maps to",
              "x-relationship": {
                "predicate": "maps-to",
                "inversePredicate": "mapped-from",
                "targetType": "Table",
                "targetLayer": "08-datastore",
                "strength": "high",
                "category": "datastore",
                "bidirectional": true
              }
            }
          ]
        }
      }
    },

    "UxProperties": {
      "type": "object",
      "description": "UX layer relationship properties",
      "properties": {
        "supports-experience": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "User Experience IDs supported by this element",
              "x-relationship": {
                "predicate": "supports",
                "inversePredicate": "supported-by",
                "targetType": "UserExperience",
                "targetLayer": "09-ux",
                "strength": "high",
                "category": "ux",
                "bidirectional": true
              }
            }
          ]
        },
        "renders-component": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "UI Component IDs rendered by this element",
              "x-relationship": {
                "predicate": "renders",
                "inversePredicate": "rendered-by",
                "targetType": "UiComponent",
                "targetLayer": "09-ux",
                "strength": "medium",
                "category": "ux",
                "bidirectional": true
              }
            }
          ]
        }
      }
    },

    "NavigationProperties": {
      "type": "object",
      "description": "Navigation layer relationship properties",
      "properties": {
        "navigates-to-route": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Route IDs this element navigates to",
              "x-relationship": {
                "predicate": "navigates-to",
                "inversePredicate": "navigated-from",
                "targetType": "Route",
                "targetLayer": "10-navigation",
                "strength": "medium",
                "category": "navigation",
                "bidirectional": true
              }
            }
          ]
        },
        "protected-by-guard": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Route Guard IDs protecting this element",
              "x-relationship": {
                "predicate": "protected-by",
                "inversePredicate": "protects",
                "targetType": "RouteGuard",
                "targetLayer": "10-navigation",
                "strength": "high",
                "category": "navigation",
                "bidirectional": true
              }
            }
          ]
        }
      }
    },

    "ApmProperties": {
      "type": "object",
      "description": "APM/Observability relationship properties",
      "properties": {
        "monitored-by-metric": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Metric IDs monitoring this element",
              "x-relationship": {
                "predicate": "monitored-by",
                "inversePredicate": "monitors",
                "targetType": "Metric",
                "targetLayer": "11-apm-observability",
                "strength": "medium",
                "category": "apm",
                "bidirectional": true
              }
            }
          ]
        },
        "has-sla": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "SLA IDs applicable to this element",
              "x-relationship": {
                "predicate": "has-sla",
                "inversePredicate": "applies-to",
                "targetType": "ServiceLevelAgreement",
                "targetLayer": "11-apm-observability",
                "strength": "high",
                "category": "apm",
                "bidirectional": true
              }
            }
          ]
        },
        "traced-by": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Trace IDs for this element",
              "x-relationship": {
                "predicate": "traced-by",
                "inversePredicate": "traces",
                "targetType": "Trace",
                "targetLayer": "11-apm-observability",
                "strength": "low",
                "category": "apm",
                "bidirectional": true
              }
            }
          ]
        }
      }
    },

    "TestingProperties": {
      "type": "object",
      "description": "Testing layer relationship properties",
      "properties": {
        "tested-by": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Test Case IDs testing this element",
              "x-relationship": {
                "predicate": "tested-by",
                "inversePredicate": "tests",
                "targetType": "TestCase",
                "targetLayer": "12-testing",
                "strength": "medium",
                "category": "testing",
                "bidirectional": true
              }
            }
          ]
        },
        "covered-by-suite": {
          "allOf": [
            { "$ref": "#/definitions/UuidReferenceArray" },
            {
              "description": "Test Suite IDs covering this element",
              "x-relationship": {
                "predicate": "covered-by",
                "inversePredicate": "covers",
                "targetType": "TestSuite",
                "targetLayer": "12-testing",
                "strength": "medium",
                "category": "testing",
                "bidirectional": true
              }
            }
          ]
        }
      }
    },

    "ConditionalCriticalityRequirements": {
      "description": "Conditional requirements based on element criticality level",
      "allOf": [
        {
          "if": {
            "properties": {
              "criticality": { "const": "critical" }
            }
          },
          "then": {
            "required": ["properties"],
            "properties": {
              "properties": {
                "required": ["motivation", "security"],
                "properties": {
                  "motivation": {
                    "required": ["supports-goals"]
                  },
                  "security": {
                    "required": ["requires-permission", "protected-by-control"]
                  }
                }
              }
            }
          }
        },
        {
          "if": {
            "properties": {
              "criticality": { "const": "high" }
            }
          },
          "then": {
            "required": ["properties"],
            "properties": {
              "properties": {
                "required": ["motivation"],
                "properties": {
                  "motivation": {
                    "required": ["supports-goals"]
                  }
                }
              }
            }
          }
        }
      ]
    }
  }
}
